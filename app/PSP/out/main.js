!function(){"use strict";try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode(".command.svelte-1bq7axd{padding:8px 12px}.command.svelte-1bq7axd:hover{cursor:pointer;background-color:#0003;color:var(--b3-theme-primary)}.command-selected.svelte-1bq7axd{color:var(--b3-theme-primary);background-color:#0003}.command-plugin.svelte-1bq7axd{font-size:14px}.command-shortcut.svelte-1bq7axd{font-size:12px;color:var(--color-text-3)}.plugin.svelte-bwhxpp span.remove.svelte-bwhxpp{display:none;color:var(--b3-theme-error);margin-left:4px}.plugin.svelte-bwhxpp:hover span.remove.svelte-bwhxpp{display:inline;cursor:pointer}.plugin.svelte-bwhxpp:hover span.remove.svelte-bwhxpp:hover{text-decoration:underline}.plugin-info.svelte-bj9chc{display:flex;align-items:center}.plugin-detail.svelte-bj9chc{margin-top:12px;width:100%}.plugin-name.svelte-bj9chc{display:inline;margin-right:6px;font-size:24px}.plugin-key.svelte-bj9chc{display:inline;font-size:16px}.plugin-manifest.svelte-bj9chc{margin-top:12px}.plugin-readme.svelte-bj9chc{margin-top:20px}.go-back.svelte-bj9chc{margin-left:12px;font-size:12px;height:24px}.go-back-icon.svelte-bj9chc{height:12px;width:12px;margin-right:4px}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}}();
(function(){var _a,_b,_c,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Reflect$1,Reflect2;Reflect2=Reflect$1||(Reflect$1={}),function(t){var n="object"==typeof commonjsGlobal?commonjsGlobal:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=o(Reflect2);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=Reflect2:r=o(n.Reflect,r),function(t){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,o=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,c=!a&&!s,u={create:a?function(){return oe(Object.create(null))}:s?function(){return oe({__proto__:null})}:function(){return oe({})},has:c?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),d="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,f=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?ne():Set,g=new(d||"function"!=typeof WeakMap?re():WeakMap);function h(e,t,n,r){if(B(n)){if(!V(e))throw new TypeError;if(!W(t))throw new TypeError;return T(e,t)}if(!V(e))throw new TypeError;if(!F(t))throw new TypeError;if(!F(r)&&!B(r)&&!L(r))throw new TypeError;return L(r)&&(r=void 0),P(e,t,n=K(n),r)}function _(e,t){function n(n,r){if(!F(n))throw new TypeError;if(!B(r)&&!Y(r))throw new TypeError;N(e,t,n,r)}return n}function y(e,t,n,r){if(!F(n))throw new TypeError;return B(r)||(r=K(r)),N(e,t,n,r)}function m(e,t,n){if(!F(t))throw new TypeError;return B(n)||(n=K(n)),O(e,t,n)}function v(e,t,n){if(!F(t))throw new TypeError;return B(n)||(n=K(n)),$(e,t,n)}function b(e,t,n){if(!F(t))throw new TypeError;return B(n)||(n=K(n)),x(e,t,n)}function w(e,t,n){if(!F(t))throw new TypeError;return B(n)||(n=K(n)),C(e,t,n)}function S(e,t){if(!F(e))throw new TypeError;return B(t)||(t=K(t)),I(e,t)}function E(e,t){if(!F(e))throw new TypeError;return B(t)||(t=K(t)),D(e,t)}function A(e,t,n){if(!F(t))throw new TypeError;B(n)||(n=K(n));var r=k(t,n,!1);if(B(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var o=g.get(t);return o.delete(n),o.size>0||g.delete(t),!0}function T(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!B(r)&&!L(r)){if(!W(r))throw new TypeError;t=r}}return t}function P(e,t,n,r){for(var o=e.length-1;o>=0;--o){var i=(0,e[o])(t,n,r);if(!B(i)&&!L(i)){if(!F(i))throw new TypeError;r=i}}return r}function k(e,t,n){var r=g.get(e);if(B(r)){if(!n)return;r=new p,g.set(e,r)}var o=r.get(t);if(B(o)){if(!n)return;o=new p,r.set(t,o)}return o}function O(e,t,n){if($(e,t,n))return!0;var r=ee(t);return!L(r)&&O(e,r,n)}function $(e,t,n){var r=k(t,n,!1);return!B(r)&&q(r.has(e))}function x(e,t,n){if($(e,t,n))return C(e,t,n);var r=ee(t);return L(r)?void 0:x(e,r,n)}function C(e,t,n){var r=k(t,n,!1);if(!B(r))return r.get(e)}function N(e,t,n,r){k(n,r,!0).set(e,t)}function I(e,t){var n=D(e,t),r=ee(e);if(null===r)return n;var o=I(r,t);if(o.length<=0)return n;if(n.length<=0)return o;for(var i=new f,a=[],s=0,c=n;s<c.length;s++){var u=c[s];i.has(u)||(i.add(u),a.push(u))}for(var l=0,d=o;l<d.length;l++)u=d[l],i.has(u)||(i.add(u),a.push(u));return a}function D(t,n){var r=[],o=k(t,n,!1);if(B(o))return r;for(var i=J(o.keys()),a=0;;){var s=Q(i);if(!s)return r.length=a,r;var c=X(s);try{r[a]=c}catch(e){try{Z(i)}finally{throw e}}a++}}function R(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function B(e){return void 0===e}function L(e){return null===e}function M(e){return"symbol"==typeof e}function F(e){return"object"==typeof e?null!==e:"function"==typeof e}function j(e,t){switch(R(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=z(e,o);if(void 0!==r){var i=r.call(e,n);if(F(i))throw new TypeError;return i}return U(e,"default"===n?"number":n)}function U(e,t){if("string"===t){var n=e.toString;if(H(n)&&!F(o=n.call(e)))return o;if(H(r=e.valueOf)&&!F(o=r.call(e)))return o}else{var r;if(H(r=e.valueOf)&&!F(o=r.call(e)))return o;var o,i=e.toString;if(H(i)&&!F(o=i.call(e)))return o}throw new TypeError}function q(e){return!!e}function G(e){return""+e}function K(e){var t=j(e,3);return M(t)?t:G(t)}function V(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function H(e){return"function"==typeof e}function W(e){return"function"==typeof e}function Y(e){switch(R(e)){case 3:case 4:return!0;default:return!1}}function z(e,t){var n=e[t];if(null!=n){if(!H(n))throw new TypeError;return n}}function J(e){var t=z(e,i);if(!H(t))throw new TypeError;var n=t.call(e);if(!F(n))throw new TypeError;return n}function X(e){return e.value}function Q(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var o=r.constructor;return"function"!=typeof o||o===e?t:o}function te(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,o=n+1;o<r;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}function ne(){return function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function re(){var e=16,t=u.create(),r=o();return function(){function e(){this._key=o()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=o()},e}();function o(){var e;do{e="@@WeakMap@@"+c()}while(u.has(t,e));return t[e]=!0,e}function i(e,t){if(!n.call(e,r)){if(!t)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}function c(){var t=s(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var o=t[r];4!==r&&6!==r&&8!==r||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}function oe(e){return e.__=void 0,delete e.__,e}t("decorate",h),t("metadata",_),t("defineMetadata",y),t("hasMetadata",m),t("hasOwnMetadata",v),t("getMetadata",b),t("getOwnMetadata",w),t("getMetadataKeys",S),t("getOwnMetadataKeys",E),t("deleteMetadata",A)}(r)}(),window.siyuan.config.system.dataDir;const VERSION$1="0.6.1",config=()=>({token:window.siyuan.config.api.token}),TYPES={StorageManager:"StorageManager",PluginSystem:"PluginSystem",SystemManager:"PluginSystemLocalManager",PluginLoader:"PluginLoader",PluginFileManager:"PluginFileManager",EventBus:"EventBus",Shortcut:"Shortcut",CommandManager:"CommandManager",Store:"Store",SettingManager:"SettingManager"};async function request$1(e,t){let n=null;return await fetch(e,{body:JSON.stringify(t),method:"POST",headers:{Authorization:`Token ${config().token}`}}).then((function(e){n=e.json()})),n}async function parseBody(e){let t=await e;return 0===t.code?t.data:null}async function transactions(e,t=[]){const n=new URL(e.ws.ws.url);return parseBody(request$1("/api/transactions",{app:n.searchParams.get("app"),session:n.searchParams.get("id"),transactions:t}))}async function sql(e){return parseBody(request$1("/api/query/sql",{stmt:e}))}async function lsNotebooks(e){return parseBody(request$1("/api/notebook/lsNotebooks",{stmt:e}))}async function getAnchor(t,n){let r=`select * from blocks where id = '${t=t.replace("((","").replace("))","")}'`,o=await sql(r),i="";if(o)try{i=o[0][n]?o[0][n]:o[0].content?o[0].content:t}catch(e){i="解析错误"}return i}async function openNotebook(e){return parseBody(request$1("/api/notebook/openNotebook",{notebook:e}))}async function closeNotebook(e){return parseBody(request$1("/api/notebook/closeNotebook",{notebook:e}))}async function renameNotebook(e,t){return parseBody(request$1("/api/notebook/renameNotebook",{notebook:e,name:t}))}async function createNotebook(e){return parseBody(request$1("/api/notebook/createNotebook",{name:e}))}async function removeNotebook(e){return parseBody(request$1("/api/notebook/removeNotebook",{notebook:e}))}async function getNotebookConf(e){return parseBody(request$1("/api/notebook/getNotebookConf",{notebook:e}))}async function setNotebookConf(e){return parseBody(request$1("/api/notebook/setNotebookConf",{notebook:e}))}async function renameDoc(e,t,n){return parseBody(request$1("/api/filetree/renameDoc",{notebook:e,path:t,title:n}))}async function removeDoc(e,t){return parseBody(request$1("/api/filetree/removeDoc",{notebook:e,path:t}))}async function moveDoc(e,t,n,r){return parseBody(request$1("/api/filetree/moveDoc",{fromNotebook:e,fromPath:t,toNotebook:n,toPath:r}))}async function getHPathByPath(e,t){return parseBody(request$1("/api/filetree/getHPathByPath",{Notebook:e,Path:t}))}async function getHPathByID(e){return parseBody(request$1("/api/filetree/getHPathByID",{id:e}))}async function getBlockAttrs(e){return parseBody(request$1("/api/attr/getBlockAttrs",{id:e}))}async function getBlockByID(e){let t=`select * from blocks where id ='${e}'`;return(await sql(t))[0]}async function getBlockKramdown(e){return parseBody(request$1("/api/block/getBlockKramdown",{id:e}))}async function getBlockBreadcrumb(e){return parseBody(request$1("/api/block/getBlockBreadcrumb",{id:e}))}async function setBlockAttrs(e,t){return parseBody(request$1("/api/attr/setBlockAttrs",{id:e,attrs:t}))}async function exportMdContent(e){return parseBody(request$1("/api/export/exportMdContent",{id:e}))}async function getDocOutline(e){return parseBody(request$1("/api/outline/getDocOutline",{id:e}))}async function listDocsByPath(e){return parseBody(request$1("/api/filetree/listDocsByPath",{path:e}))}async function getBacklink(e){return parseBody(request$1("/api/ref/getBacklink",{id:e,beforeLen:10,k:"",mk:""}))}async function searchEmbedBlock(e,t){return parseBody(request$1("/api/search/searchEmbedBlock",{stmt:t,excludeIDs:e}))}async function getDoc(e){return parseBody(request$1("/api/filetree/getDoc",{id:e,k:"",mode:2,size:36}))}async function getFocusedDoc(e){return parseBody(request$1("/api/filetree/getDoc",{id:e,k:"",mode:0,size:36}))}async function getTag(){return parseBody(request$1("/api/tag/getTag",{}))}async function getLocalGraph(e,t,n,r){return parseBody(request$1("/api/graph/getLocalGraph",{id:t,k:e,conf:n,reqId:r}))}async function getGraph(e,t,n){return parseBody(request$1("/api/graph/getGraph",{k:e,conf:t,reqId:n}))}async function searchDocs(e){return parseBody(request$1("/api/filetree/searchDocs",{k:e}))}async function searchBlock(e){return parseBody(request$1("/api/search/searchBlock",{query:e}))}async function searchTemplate(e){return parseBody(request$1("/api/search/searchTemplate",{k:e}))}async function createDocWithMd(e,t,n){return parseBody(request$1("/api/filetree/createDocWithMd",{notebook:e,path:t,markdown:n}))}async function docSaveAsTemplate(e,t=!1){return parseBody(request$1("/api/template/docSaveAsTemplate",{id:e,overwrite:t}))}async function render(e){return parseBody(request$1("/api/template/render",e))}async function insertBlock(e,t,n){let r="/api/block/insertBlock";return parseBody(request$1(r,n={previousID:e,dataType:t,data:n}))}async function prependBlock(e,t,n){let r="/api/block/prependBlock";return parseBody(request$1(r,n={parentID:e,dataType:t,data:n}))}async function appendBlock(e,t,n){let r="/api/block/appendBlock";return parseBody(request$1(r,n={parentID:e,dataType:t,data:n}))}async function updateBlock(e,t,n){let r="/api/block/updateBlock";return parseBody(request$1(r,n={id:e,dataType:t,data:n}))}async function deleteBlock(e){return parseBody(request$1("/api/block/deleteBlock",{id:e}))}async function moveBlock(e,t,n){return parseBody(request$1("/api/block/moveBlock",{id:e,previousID:t,parentID:n}))}async function getSysFonts(){return parseBody(request$1("/api/system/getSysFonts",null))}async function getFile(e,t="text"){const n=await fetch("/api/file/getFile",{method:"POST",headers:{Authorization:`Token ${config().token}`},body:JSON.stringify({path:e})});if(200===n.status){if("text"===t)return await n.text();if("json"===t)return(await n.json()).data}return null}async function putFile(e,t,n=!1,r=Date.now()){let o=new Blob([t]),i=new File([o],e.split("/").pop()),a=new FormData;a.append("path",e),a.append("file",i),a.append("isDir",String(n)),a.append("modTime",String(r));const s=await fetch("/api/file/putFile",{body:a,method:"POST",headers:{Authorization:`Token ${config().token}`}});return 200===s.status?await s.json():null}async function readDir(e){const t=await fetch("/api/file/readDir",{method:"POST",headers:{Authorization:`Token ${config().token}`},body:JSON.stringify({path:e})});return 200===t.status?(await t.json()).data:null}async function removeFile(e){return 200===(await fetch("/api/file/removeFile",{method:"POST",headers:{Authorization:`Token ${config().token}`},body:JSON.stringify({path:e})})).status?void 0:null}const language=null==(_a=window.theme)?void 0:_a.languageMode;async function pushMsg(e=null,t=null,n=7e3){return parseBody(request$1("/api/notification/pushMsg",{msg:e?e[language]||e.other:t,timeout:n}))}async function pushErrMsg(e=null,t=null,n=7e3){return parseBody(request$1("/api/notification/pushErrMsg",{msg:e?e[language]||e.other:t,timeout:n}))}async function setStorageVal(e,t){return parseBody(request$1("/api/storage/setLocalStorageVal",{app:genUUID(),key:e,val:t}))}async function getLocalStorage(){return parseBody(request$1("/api/storage/getLocalStorage",null))}async function renderSprig(e){return parseBody(request$1("/api/template/renderSprig",e))}const serverApi=Object.freeze(Object.defineProperty({__proto__:null,appendBlock:appendBlock,closeNotebook:closeNotebook,createDocWithMd:createDocWithMd,createNotebook:createNotebook,deleteBlock:deleteBlock,docSaveAsTemplate:docSaveAsTemplate,exportMdContent:exportMdContent,getAnchor:getAnchor,getBacklink:getBacklink,getBlockAttrs:getBlockAttrs,getBlockBreadcrumb:getBlockBreadcrumb,getBlockByID:getBlockByID,getBlockKramdown:getBlockKramdown,getDoc:getDoc,getDocOutline:getDocOutline,getFile:getFile,getFocusedDoc:getFocusedDoc,getGraph:getGraph,getHPathByID:getHPathByID,getHPathByPath:getHPathByPath,getLocalGraph:getLocalGraph,getLocalStorage:getLocalStorage,getNotebookConf:getNotebookConf,getSysFonts:getSysFonts,getTag:getTag,insertBlock:insertBlock,listDocsByPath:listDocsByPath,lsNotebooks:lsNotebooks,moveBlock:moveBlock,moveDoc:moveDoc,openNotebook:openNotebook,parseBody:parseBody,prependBlock:prependBlock,pushErrMsg:pushErrMsg,pushMsg:pushMsg,putFile:putFile,readDir:readDir,removeDoc:removeDoc,removeFile:removeFile,removeNotebook:removeNotebook,renameDoc:renameDoc,renameNotebook:renameNotebook,render:render,renderSprig:renderSprig,request:request$1,searchBlock:searchBlock,searchDocs:searchDocs,searchEmbedBlock:searchEmbedBlock,searchTemplate:searchTemplate,setBlockAttrs:setBlockAttrs,setNotebookConf:setNotebookConf,setStorageVal:setStorageVal,sql:sql,transactions:transactions,updateBlock:updateBlock},Symbol.toStringTag,{value:"Module"}));class Notification{constructor(e){this.option=e}show(){"error"===this.option.type?pushErrMsg(null,this.option.message,this.option.timeout):pushMsg(null,this.option.message,this.option.timeout)}}var z=Object.defineProperty,D=(e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_$1=(e,t,n)=>(D(e,"symbol"!=typeof t?t+"":t,n),n),P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b={},W={get exports(){return b},set exports(e){b=e}},i,e,t;i=W,e=P,t=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(t,n){for(var o=0;o<r.length;o++){var i=r[o];this[i]=o<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function s(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}function c(r,a,c){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?i:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,"log"):e)}(r)||s.apply(this,arguments)}function u(e,n,o){var i,s=this;n=n??"WARN";var u="loglevel";function l(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch{}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=o||c,s.getLevel=function(){return i},s.setLevel=function(n,o){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==o&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch{}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch{}}}(n),a.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,l()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),function(){if(typeof window!==t&&u){try{return void window.localStorage.removeItem(u)}catch{}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var d=l();null==d&&(d=n),s.setLevel(d,!1)}var l=new u,d={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,l.getLevel(),l.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=p),l},l.getLoggers=function(){return d},l.default=l,l},i.exports?i.exports=t():e.log=t();var R={},B={get exports(){return R},set exports(e){R=e}};!function(e){!function(t,n){e.exports?e.exports=n():t.prefix=n(t)}(P,(function(e){var t,n,r={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o={},i={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,n){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var i=e.methodFactory,a=e.name||"",s=o[a]||o[""]||r;return o[a]||(e.methodFactory=function(e,t,n){var r=i(e,t,n),s=o[n]||o[""],c=-1!==s.template.indexOf("%t"),u=-1!==s.template.indexOf("%l"),l=-1!==s.template.indexOf("%n");return function(){for(var t="",i=arguments.length,d=Array(i),p=0;p<i;p++)d[p]=arguments[p];if(a||!o[n]){var f=s.timestampFormatter(new Date),g=s.levelFormatter(e),h=s.nameFormatter(n);s.format?t+=s.format(g,h,f):(t+=s.template,c&&(t=t.replace(/%t/,f)),u&&(t=t.replace(/%l/,g)),l&&(t=t.replace(/%n/,h))),d.length&&"string"==typeof d[0]?d[0]=t+" "+d[0]:d.unshift(t)}r.apply(void 0,d)}}),(n=n||{}).template&&(n.format=void 0),o[a]=function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(t in arguments[n])Object.prototype.hasOwnProperty.call(arguments[n],t)&&(e[t]=arguments[n][t]);return e}({},s,n),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(n=e.prefix,i.noConflict=function(){return e.prefix===i&&(e.prefix=n),i}),i}))}(B);class T{}_$1(T,"LOG_LEVEL_KEY","VITE_LOG_LEVEL"),_$1(T,"LOG_PREFIX_KEY","VITE_LOG_PREFIX");var S=(e=>(e.LOG_LEVEL_DEBUG="DEBUG",e.LOG_LEVEL_INFO="INFO",e.LOG_LEVEL_WARN="WARN",e.LOG_LEVEL_ERROR="ERROR",e))(S||{});function K(){const e=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const t=(new Error).stack.slice(1);return Error.prepareStackTrace=e,t}class I{static stringToEnumValue(e,t){return e[Object.keys(e).filter((n=>e[n].toString()===t))[0]]}static getEnvLevel(e){if(!e)return;const t=e.getEnvOrDefault(T.LOG_LEVEL_KEY,S.LOG_LEVEL_INFO),n=I.stringToEnumValue(S,t.toUpperCase());return n||console.warn("[zhi-log] LOG_LEVEL is invalid in you .env file.Must be either debug, info, warn or error, fallback to default info level"),n}static getEnvLogger(e){if(e)return e.getEnv(T.LOG_PREFIX_KEY)}}class Y{constructor(e,t,n){let r;_$1(this,"consoleLogger","console"),_$1(this,"stackSize",1),_$1(this,"getLogger",(e=>{let t;if(e)t=e;else{const e=this.getCallStack(),n=[],r=[];for(let t=0;t<e.length;t++){const r=e[t],o=r.getFileName()??"none";if(t>this.stackSize-1)break;const i=o+"-"+r.getLineNumber()+":"+r.getColumnNumber();n.push(i)}r.length>0&&(t=n.join(" -> "))}return(!t||0===t.trim().length)&&(t=this.consoleLogger),b.getLogger(t)})),this.stackSize=1,r=e||I.getEnvLevel(n),r=r??S.LOG_LEVEL_INFO,b.setLevel(r);const o=e=>e.toString(),i=e=>e.toString(),a=e=>e.toString(),s=e=>e.toString();R.reg(b),R.apply(b,{format(e,r,c){const u=["["+(t??I.getEnvLogger(n)??"zhi")+"]"];switch(u.push(o("[")+i(c).toString()+o("]")),e){case S.LOG_LEVEL_DEBUG:u.push(o(e.toUpperCase().toString()));break;case S.LOG_LEVEL_INFO:u.push(i(e.toUpperCase().toString()));break;case S.LOG_LEVEL_WARN:u.push(a(e.toUpperCase().toString()));break;case S.LOG_LEVEL_ERROR:u.push(s(e.toUpperCase().toString()))}return u.push(i(r).toString()),u.push(o(":")),u.join(" ")}})}setStackSize(e){this.stackSize=e??1}getCallStack(){let e;try{e=K()}catch{e=[]}return e}}class X{constructor(e,t,n){_$1(this,"logger"),this.logger=new Y(e,t,n)}getLogger(e,t){return this.logger.setStackSize(t),this.logger.getLogger(e)}}class N extends X{constructor(e,t,n){super(e,t,n)}getLogger(e,t){return super.getLogger(e,t)}}class M{static defaultLogger(e,t){return M.customLogFactory(void 0,void 0,e).getLogger(void 0,t)}static customLogFactory(e,t,n){return new N(e,t,n)}static customSignLogFactory(e,t){return new N(void 0,e,t)}}function insertBefore(e,t){return e.insertAdjacentElement("beforebegin",t)}function insertAfter(e,t){return e.insertAdjacentElement("afterend",t)}function addToolbarLeft(e){var t;const n=null==(t=document.getElementById("toolbar"))?void 0:t.getElementsByClassName("fn__ellipsis");n&&insertBefore(n[0],e)}function addToolbarRight(e){var t;const n=null==(t=document.getElementById("toolbar"))?void 0:t.getElementsByClassName("fn__ellipsis");n&&insertAfter(n[0],e)}const createLogger=e=>getLogger(e),clientApi=Object.freeze(Object.defineProperty({__proto__:null,addToolbarLeft:addToolbarLeft,addToolbarRight:addToolbarRight,createLogger:createLogger},Symbol.toStringTag,{value:"Module"})),menu=null==(_c=null==(_b=window.siyuan)?void 0:_b.menus)?void 0:_c.menu;class Menu{constructor(e){if(!menu)throw Error("Siyuan internal menu not found!");if(!e)throw Error("Menu must has an id, got empty or undefined!");menu.remove(),menu.element.setAttribute("data-name",e)}addItem(e){return menu.append(e.element),this}addSeparator(){return this.addItem(new MenuItem({type:"separator"})),this}showAtMouseEvent(e){return menu.popup({x:e.clientX,y:e.clientY}),this}showAtPosition(e){return menu.popup({x:e.x,y:e.y}),this}close(){menu.remove()}}class MenuItem{constructor(e){if(this.element=document.createElement("button"),e.disabled&&this.element.setAttribute("disabled","disabled"),"separator"===e.type)return void this.element.classList.add("b3-menu__separator");this.element.classList.add("b3-menu__item"),e.current&&this.element.classList.add("b3-menu__item--selected"),e.click&&this.element.addEventListener("click",(t=>{this.element.getAttribute("disabled")||(e.click(this.element),t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),window.siyuan.menus.menu.remove())}));let t=`<span class="b3-menu__label">${e.label}</span>`;if(t=e.iconHTML?e.iconHTML+t:`<svg class="b3-menu__icon${["HTML (SiYuan)",window.siyuan.languages.template].includes(e.label)?" ft__error":""}" style="${"iconClose"===e.icon?"height:10px;":""}"><use xlink:href="#${e.icon||""}"></use></svg>${t}`,e.action&&(t+=`<svg class="b3-menu__action"><use xlink:href="#${e.action}"></use></svg>`),e.id&&this.element.setAttribute("data-id",e.id),"readonly"===e.type&&this.element.classList.add("b3-menu__item--readonly"),this.element.innerHTML=t,e.bind&&(this.element.classList.add("b3-menu__item--custom"),e.bind(this.element)),e.submenu){const t=document.createElement("div");t.classList.add("b3-menu__submenu"),e.submenu.forEach((e=>{t.append(new MenuItem(e).element)})),this.element.insertAdjacentHTML("beforeend",'<svg class="b3-menu__icon b3-menu__icon--arrow"><use xlink:href="#iconRight"></use></svg>'),this.element.append(t)}}}class MenuSeparator{}class Dialog{constructor(e){this.disableClose=e.disableClose,this.id=genUUID(),window.siyuan.dialogs.push(this),this.destroyCallback=e.destroyCallback,this.element=document.createElement("div"),this.element.innerHTML=`<div class="b3-dialog">\n<div class="b3-dialog__scrim"${e.transparent?'style="background-color:transparent"':""}></div>\n<div class="b3-dialog__container" style="width:${e.width||"auto"}">\n  <svg class="b3-dialog__close fn__a${this.disableClose?" fn__none":""}"><use xlink:href="#iconClose"></use></svg>\n  <div class="b3-dialog__header${e.title?"":" fn__none"}" onselectstart="return false;">${e.title||""}</div>\n  <div style="height:${e.height||"auto"}">${e.content}</div>\n</div></div>`,this.element.querySelector(".b3-dialog__scrim").addEventListener("click",(e=>{this.disableClose||this.destroy(),e.preventDefault(),e.stopPropagation(),window.siyuan.menus.menu.remove()})),this.disableClose||this.element.querySelector(".b3-dialog__close").addEventListener("click",(e=>{this.destroy(),e.preventDefault(),e.stopPropagation()})),document.body.append(this.element),e.disableAnimation?this.element.classList.add("b3-dialog--open"):setTimeout((()=>{this.element.classList.add("b3-dialog--open")})),window.siyuan.menus.menu.remove()}static destroyAll(){window.siyuan.dialogs.forEach((e=>e.destroy()))}destroy(){this.element.remove(),window.siyuan.menus.menu.remove(),this.destroyCallback&&this.destroyCallback(),window.siyuan.dialogs.find(((e,t)=>{if(e.id===this.id)return window.siyuan.dialogs.splice(t,1),!0}))}bindInput(e,t){e.focus(),e.addEventListener("keydown",(e=>{if(!e.isComposing)return"Escape"===e.key?(this.destroy(),e.preventDefault(),void e.stopPropagation()):void("Enter"===e.key&&t&&(t(),e.preventDefault()));e.preventDefault()}))}}class Plugin{onload(){}onunload(){}registerCommand(e){}registerSettingRender(e){}async loadStorage(e){return null}async writeStorage(e,t){}}const api={clientApi:clientApi,serverApi:serverApi,Plugin:Plugin,Menu:Menu,MenuItem:MenuItem,MenuSeparator:MenuSeparator,Notification:Notification,Dialog:Dialog};class FileClient{constructor(){this.electronApi={readDir(e){const t=window.require("fs"),n=window.require("path"),r=n.join(window.siyuan.config.system.dataDir,"..");return new Promise((o=>{t.readdir(n.join(r,e),((i,a)=>{if(i)return void o([]);const s=a.map((o=>({isDir:t.statSync(n.join(r,e,o)).isDirectory(),name:o})));o(s)}))}))},getFile:(t,n="text")=>new Promise(((r,o)=>{const i=window.require("fs"),a=window.require("path"),s=a.join(window.siyuan.config.system.dataDir,"..");i.readFile(a.join(s,t),((t,i)=>{if(t)return o(t);const a=i.toString("utf8");if("json"===n)try{return r(JSON.parse(a))}catch(e){return void o(e)}return r(a)}))})),putFile:putFile,removeFile:e=>new Promise(((t,n)=>{const r=window.require("fs"),o=window.require("path"),i=o.join(window.siyuan.config.system.dataDir,".."),a=o.join(i,e);log("Remove files from",a),r.rm(a,{recursive:!0,force:!0},(e=>{if(e)return n(e);t(null)}))}))},this.serverApi={readDir:readDir,getFile:getFile,putFile:putFile,removeFile:removeFile},this.fileApi=this.serverApi}getVersion(){return window.siyuan.config.system.kernelVersion}static getInstanceApi(){return this.fileClient||(this.fileClient=new FileClient),this.fileClient}}const author$1="作者",version$1="版本",description$1="描述",goBack$1="返回",url$1="地址",readme$1="README",loading$1="加载中",downloading$1="下载中",downloaded$1="已下载",download$1="下载",upgrade$1="升级",nodescription$1="无描述内容",safemode$1="安全模式",safemodetip$1="关闭安全模式允许第三方插件加载",autoupgrade$1="自动更新",autoupgradetip$1="从固定位置获取版本并更新本地存储的插件系统脚本",store_url$1="插件商店地址",store_url_tip$1="线上插件系统仓库地址, 默认为",menu_common$1="通用配置",menu_list$1="插件列表",menu_store$1="插件商店",plugin_system$1="插件系统",plugin_system_setting$1="插件系统设置",reload$1="重载",show_plugin_system_config$1="显示插件系统配置",reload_window$1="重载当前窗口",shortcut$1="快捷键",show_command_panel$1="显示控制面板",uninstall$1="卸载",zh_CN={author:author$1,version:version$1,description:description$1,goBack:goBack$1,url:url$1,readme:readme$1,loading:loading$1,downloading:downloading$1,downloaded:downloaded$1,download:download$1,upgrade:upgrade$1,nodescription:nodescription$1,safemode:safemode$1,safemodetip:safemodetip$1,autoupgrade:autoupgrade$1,autoupgradetip:autoupgradetip$1,store_url:store_url$1,store_url_tip:store_url_tip$1,menu_common:menu_common$1,menu_list:menu_list$1,menu_store:menu_store$1,plugin_system:plugin_system$1,plugin_system_setting:plugin_system_setting$1,reload:reload$1,show_plugin_system_config:show_plugin_system_config$1,reload_window:reload_window$1,shortcut:shortcut$1,show_command_panel:show_command_panel$1,uninstall:uninstall$1},author="Author",version="Version",description="Description",goBack="Go Back",url="URL",readme="README",loading="Loading",downloading="Downloading",downloaded="Downloaded",download="Download",upgrade="Upgrade",nodescription="No Description content",safemode="Safe Mode",safemodetip="Turn off safe mode to enable third party plugins.",autoupgrade="Auto Upgrade",autoupgradetip="Auto upgrade plugin system online.",store_url="Plugin Store URL",store_url_tip="Plugin Store URL, default is",menu_common="Common Setting",menu_list="Plugins",menu_store="Store",plugin_system="Plugin System",plugin_system_setting="Plugin System Setting",reload="Reload",show_plugin_system_config="Show plugin system config",reload_window="Reload current window",shortcut="Shortcut",show_command_panel="Show command panel",uninstall="Uninstall",en_US={author:author,version:version,description:description,goBack:goBack,url:url,readme:readme,loading:loading,downloading:downloading,downloaded:downloaded,download:download,upgrade:upgrade,nodescription:nodescription,safemode:safemode,safemodetip:safemodetip,autoupgrade:autoupgrade,autoupgradetip:autoupgradetip,store_url:store_url,store_url_tip:store_url_tip,menu_common:menu_common,menu_list:menu_list,menu_store:menu_store,plugin_system:plugin_system,plugin_system_setting:plugin_system_setting,reload:reload,show_plugin_system_config:show_plugin_system_config,reload_window:reload_window,shortcut:shortcut,show_command_panel:show_command_panel,uninstall:uninstall};function bind(e,t){return function(){return e.apply(t,arguments)}}const{toString:toString}=Object.prototype,{getPrototypeOf:getPrototypeOf}=Object,kindOf=(cache=Object.create(null),e=>{const t=toString.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())});var cache;const kindOfTest=e=>(e=e.toLowerCase(),t=>kindOf(t)===e),typeOfTest=e=>t=>typeof t===e,{isArray:isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&isFunction(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer),t}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=e=>null!==e&&"object"==typeof e,isBoolean=e=>!0===e||!1===e,isPlainObject=e=>{if("object"!==kindOf(e))return!1;const t=getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=e=>isObject(e)&&isFunction(e.pipe),isFormData=e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString.call(e)===t||isFunction(e.toString)&&e.toString()===t)},isURLSearchParams=kindOfTest("URLSearchParams"),trim=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,o;if("object"!=typeof e&&(e=[e]),isArray(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const o=n?Object.getOwnPropertyNames(e):Object.keys(e),i=o.length;let a;for(r=0;r<i;r++)a=o[r],t.call(null,e[a],a,e)}}function findKey(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const _global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,isContextDefined=e=>!isUndefined(e)&&e!==_global;function merge(){const{caseless:e}=isContextDefined(this)&&this||{},t={},n=(n,r)=>{const o=e&&findKey(t,r)||r;isPlainObject(t[o])&&isPlainObject(n)?t[o]=merge(t[o],n):isPlainObject(n)?t[o]=merge({},n):isArray(n)?t[o]=n.slice():t[o]=n};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&forEach(arguments[r],n);return t}const extend=(e,t,n,{allOwnKeys:r}={})=>(forEach(t,((t,r)=>{n&&isFunction(t)?e[r]=bind(t,n):e[r]=t}),{allOwnKeys:r}),e),stripBOM=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject=(e,t,n,r)=>{let o,i,a;const s={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)a=o[i],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},endsWith=(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray=e=>{if(!e)return null;if(isArray(e))return e;let t=e.length;if(!isNumber(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},isTypedArray=(TypedArray="undefined"!=typeof Uint8Array&&getPrototypeOf(Uint8Array),e=>TypedArray&&e instanceof TypedArray);var TypedArray;const forEachEntry=(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll=(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),hasOwnProperty=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};forEach(n,((n,o)=>{!1!==t(n,o,e)&&(r[o]=n)})),Object.defineProperties(e,r)},freezeMethods=e=>{reduceDescriptors(e,((t,n)=>{if(isFunction(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];isFunction(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet=(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return isArray(e)?r(e):r(String(e).split(t)),n},noop$1=()=>{},toFiniteNumber=(e,t)=>(e=+e,Number.isFinite(e)?e:t),ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT:DIGIT,ALPHA:ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(e=16,t=ALPHABET.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n};function isSpecCompliantForm(e){return!!(e&&isFunction(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}const toJSONObject=e=>{const t=new Array(10),n=(e,r)=>{if(isObject(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const o=isArray(e)?[]:{};return forEach(e,((e,t)=>{const i=n(e,r+1);!isUndefined(i)&&(o[t]=i)})),t[r]=void 0,o}}return e};return n(e,0)},utils={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isBoolean:isBoolean,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isRegExp:isRegExp,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isTypedArray:isTypedArray,isFileList:isFileList,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,forEachEntry:forEachEntry,matchAll:matchAll,isHTMLForm:isHTMLForm,hasOwnProperty:hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors:reduceDescriptors,freezeMethods:freezeMethods,toObjectSet:toObjectSet,toCamelCase:toCamelCase,noop:noop$1,toFiniteNumber:toFiniteNumber,findKey:findKey,global:_global,isContextDefined:isContextDefined,ALPHABET:ALPHABET,generateString:generateString,isSpecCompliantForm:isSpecCompliantForm,toJSONObject:toJSONObject};function AxiosError(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}utils.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{descriptors[e]={value:e}})),Object.defineProperties(AxiosError,descriptors),Object.defineProperty(prototype$1,"isAxiosError",{value:!0}),AxiosError.from=(e,t,n,r,o,i)=>{const a=Object.create(prototype$1);return utils.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),AxiosError.call(a,e.message,t,n,r,o),a.cause=e,a.name=e.name,i&&Object.assign(a,i),a};const httpAdapter=null;function isVisitable(e){return utils.isPlainObject(e)||utils.isArray(e)}function removeBrackets(e){return utils.endsWith(e,"[]")?e.slice(0,-2):e}function renderKey(e,t,n){return e?e.concat(t).map((function(e,t){return e=removeBrackets(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}function isFlatArray(e){return utils.isArray(e)&&!e.some(isVisitable)}const predicates=utils.toFlatObject(utils,{},null,(function(e){return/^is[A-Z]/.test(e)}));function toFormData(e,t,n){if(!utils.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=utils.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!utils.isUndefined(t[e])}))).metaTokens,o=n.visitor||u,i=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&utils.isSpecCompliantForm(t);if(!utils.isFunction(o))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(utils.isDate(e))return e.toISOString();if(!s&&utils.isBlob(e))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils.isArrayBuffer(e)||utils.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,o){let s=e;if(e&&!o&&"object"==typeof e)if(utils.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(utils.isArray(e)&&isFlatArray(e)||(utils.isFileList(e)||utils.endsWith(n,"[]"))&&(s=utils.toArray(e)))return n=removeBrackets(n),s.forEach((function(e,r){!utils.isUndefined(e)&&null!==e&&t.append(!0===a?renderKey([n],r,i):null===a?n:n+"[]",c(e))})),!1;return!!isVisitable(e)||(t.append(renderKey(o,n,i),c(e)),!1)}const l=[],d=Object.assign(predicates,{defaultVisitor:u,convertValue:c,isVisitable:isVisitable});if(!utils.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!utils.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),utils.forEach(n,(function(n,i){!0===(!(utils.isUndefined(n)||null===n)&&o.call(t,n,utils.isString(i)?i.trim():i,r,d))&&e(n,r?r.concat(i):[i])})),l.pop()}}(e),t}function encode$1(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function AxiosURLSearchParams(e,t){this._pairs=[],e&&toFormData(e,this,t)}const prototype=AxiosURLSearchParams.prototype;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(e,t,n){if(!t)return e;const r=n&&n.encode||encode,o=n&&n.serialize;let i;if(i=o?o(t,n):utils.isURLSearchParams(t)?t.toString():new AxiosURLSearchParams(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}prototype.append=function(e,t){this._pairs.push([e,t])},prototype.toString=function(e){const t=e?function(t){return e.call(this,t,encode$1)}:encode$1;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class InterceptorManager{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}const InterceptorManager$1=InterceptorManager,transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1="undefined"!=typeof URLSearchParams?URLSearchParams:AxiosURLSearchParams,FormData$1="undefined"!=typeof FormData?FormData:null,Blob$1="undefined"!=typeof Blob?Blob:null,isStandardBrowserEnv=(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,platform={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},isStandardBrowserEnv:isStandardBrowserEnv,isStandardBrowserWebWorkerEnv:isStandardBrowserWebWorkerEnv,protocols:["http","https","file","blob","url","data"]};function toURLEncodedForm(e,t){return toFormData(e,new platform.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return platform.isNode&&utils.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}function parsePropPath(e){return utils.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}function arrayToObject(e){const t={},n=Object.keys(e);let r;const o=n.length;let i;for(r=0;r<o;r++)i=n[r],t[i]=e[i];return t}function formDataToJSON(e){function t(e,n,r,o){let i=e[o++];const a=Number.isFinite(+i),s=o>=e.length;if(i=!i&&utils.isArray(r)?r.length:i,s)return utils.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!a;r[i]&&utils.isObject(r[i])||(r[i]=[]);return t(e,n,r[i],o)&&utils.isArray(r[i])&&(r[i]=arrayToObject(r[i])),!a}if(utils.isFormData(e)&&utils.isFunction(e.entries)){const n={};return utils.forEachEntry(e,((e,r)=>{t(parsePropPath(e),r,n,0)})),n}return null}const DEFAULT_CONTENT_TYPE={"Content-Type":void 0};function stringifySafely(t,n,r){if(utils.isString(t))try{return(n||JSON.parse)(t),utils.trim(t)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(t)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=utils.isObject(e);o&&utils.isHTMLForm(e)&&(e=new FormData(e));if(utils.isFormData(e))return r&&r?JSON.stringify(formDataToJSON(e)):e;if(utils.isArrayBuffer(e)||utils.isBuffer(e)||utils.isStream(e)||utils.isFile(e)||utils.isBlob(e))return e;if(utils.isArrayBufferView(e))return e.buffer;if(utils.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((i=utils.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return toFormData(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(t){const n=this.transitional||defaults.transitional,r=n&&n.forcedJSONParsing,o="json"===this.responseType;if(t&&utils.isString(t)&&(r&&!this.responseType||o)){const r=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(e){if(r){if("SyntaxError"===e.name)throw AxiosError.from(e,AxiosError.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],(function(e){defaults.headers[e]={}})),utils.forEach(["post","put","patch"],(function(e){defaults.headers[e]=utils.merge(DEFAULT_CONTENT_TYPE)}));const defaults$1=defaults,ignoreDuplicateOf=utils.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=e=>{const t={};let n,r,o;return e&&e.split("\n").forEach((function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&ignoreDuplicateOf[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t},$internals=Symbol("internals");function normalizeHeader(e){return e&&String(e).trim().toLowerCase()}function normalizeValue(e){return!1===e||null==e?e:utils.isArray(e)?e.map(normalizeValue):String(e)}function parseTokens(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}function isValidHeaderName(e){return/^[-_a-zA-Z]+$/.test(e.trim())}function matchHeaderValue(e,t,n,r,o){return utils.isFunction(r)?r.call(this,t,n):(o&&(t=n),utils.isString(t)?utils.isString(r)?-1!==t.indexOf(r):utils.isRegExp(r)?r.test(t):void 0:void 0)}function formatHeader(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}function buildAccessors(e,t){const n=utils.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})}))}class AxiosHeaders{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=normalizeHeader(t);if(!o)throw new Error("header name must be a non-empty string");const i=utils.findKey(r,o);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=normalizeValue(e))}const i=(e,t)=>utils.forEach(e,((e,n)=>o(e,n,t)));return utils.isPlainObject(e)||e instanceof this.constructor?i(e,t):utils.isString(e)&&(e=e.trim())&&!isValidHeaderName(e)?i(parseHeaders(e),t):null!=e&&o(t,e,n),this}get(e,t){if(e=normalizeHeader(e)){const n=utils.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return parseTokens(e);if(utils.isFunction(t))return t.call(this,e,n);if(utils.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=normalizeHeader(e)){const n=utils.findKey(this,e);return!(!n||void 0===this[n]||t&&!matchHeaderValue(this,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=normalizeHeader(e)){const o=utils.findKey(n,e);!o||t&&!matchHeaderValue(n,n[o],o,t)||(delete n[o],r=!0)}}return utils.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!matchHeaderValue(this,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return utils.forEach(this,((r,o)=>{const i=utils.findKey(n,o);if(i)return t[i]=normalizeValue(r),void delete t[o];const a=e?formatHeader(o):String(o).trim();a!==o&&delete t[o],t[a]=normalizeValue(r),n[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return utils.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&utils.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[$internals]=this[$internals]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=normalizeHeader(e);t[r]||(buildAccessors(n,e),t[r]=!0)}return utils.isArray(e)?e.forEach(r):r(e),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils.freezeMethods(AxiosHeaders.prototype),utils.freezeMethods(AxiosHeaders);const AxiosHeaders$1=AxiosHeaders;function transformData(e,t){const n=this||defaults$1,r=t||n,o=AxiosHeaders$1.from(r.headers);let i=r.data;return utils.forEach(e,(function(e){i=e.call(n,i,o.normalize(),t?t.status:void 0)})),o.normalize(),i}function isCancel(e){return!(!e||!e.__CANCEL__)}function CanceledError(e,t,n){AxiosError.call(this,null==e?"canceled":e,AxiosError.ERR_CANCELED,t,n),this.name="CanceledError"}function settle(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new AxiosError("Request failed with status code "+n.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}utils.inherits(CanceledError,AxiosError,{__CANCEL__:!0});const cookies=platform.isStandardBrowserEnv?{write:function(e,t,n,r,o,i){const a=[];a.push(e+"="+encodeURIComponent(t)),utils.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),utils.isString(r)&&a.push("path="+r),utils.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}function buildFullPath(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t}const isURLSameOrigin=platform.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=utils.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function parseProtocol(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function speedometer(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,i=0,a=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),u=r[a];o||(o=c),n[i]=s,r[i]=c;let l=a,d=0;for(;l!==i;)d+=n[l++],l%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),c-o<t)return;const p=u&&c-u;return p?Math.round(1e3*d/p):void 0}}function progressEventReducer(e,t){let n=0;const r=speedometer(50,250);return o=>{const i=o.loaded,a=o.lengthComputable?o.total:void 0,s=i-n,c=r(s);n=i;const u={loaded:i,total:a,progress:a?i/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&i<=a?(a-i)/c:void 0,event:o};u[t?"download":"upload"]=!0,e(u)}}const isXHRAdapterSupported="undefined"!=typeof XMLHttpRequest,xhrAdapter=isXHRAdapterSupported&&function(e){return new Promise((function(t,n){let r=e.data;const o=AxiosHeaders$1.from(e.headers).normalize(),i=e.responseType;let a;function s(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}utils.isFormData(r)&&(platform.isStandardBrowserEnv||platform.isStandardBrowserWebWorkerEnv)&&o.setContentType(!1);let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.set("Authorization","Basic "+btoa(t+":"+n))}const u=buildFullPath(e.baseURL,e.url);function l(){if(!c)return;const r=AxiosHeaders$1.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());settle((function(e){t(e),s()}),(function(e){n(e),s()}),{data:i&&"text"!==i&&"json"!==i?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),buildURL(u,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=l:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(l)},c.onabort=function(){c&&(n(new AxiosError("Request aborted",AxiosError.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new AxiosError("Network Error",AxiosError.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||transitionalDefaults;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new AxiosError(t,r.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,e,c)),c=null},platform.isStandardBrowserEnv){const t=(e.withCredentials||isURLSameOrigin(u))&&e.xsrfCookieName&&cookies.read(e.xsrfCookieName);t&&o.set(e.xsrfHeaderName,t)}void 0===r&&o.setContentType(null),"setRequestHeader"in c&&utils.forEach(o.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),utils.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),i&&"json"!==i&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",progressEventReducer(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",progressEventReducer(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{c&&(n(!t||t.type?new CanceledError(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const d=parseProtocol(u);d&&-1===platform.protocols.indexOf(d)?n(new AxiosError("Unsupported protocol "+d+":",AxiosError.ERR_BAD_REQUEST,e)):c.send(r||null)}))},knownAdapters={http:httpAdapter,xhr:xhrAdapter};utils.forEach(knownAdapters,((t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch(e){}Object.defineProperty(t,"adapterName",{value:n})}}));const adapters={getAdapter:e=>{e=utils.isArray(e)?e:[e];const{length:t}=e;let n,r;for(let o=0;o<t&&(n=e[o],!(r=utils.isString(n)?knownAdapters[n.toLowerCase()]:n));o++);if(!r){if(!1===r)throw new AxiosError(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(utils.hasOwnProp(knownAdapters,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!utils.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:knownAdapters};function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError(null,e)}function dispatchRequest(e){throwIfCancellationRequested(e),e.headers=AxiosHeaders$1.from(e.headers),e.data=transformData.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return adapters.getAdapter(e.adapter||defaults$1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,e.transformResponse,t),t.headers=AxiosHeaders$1.from(t.headers),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,e.transformResponse,t.response),t.response.headers=AxiosHeaders$1.from(t.response.headers))),Promise.reject(t)}))}const headersToObject=e=>e instanceof AxiosHeaders$1?e.toJSON():e;function mergeConfig(e,t){t=t||{};const n={};function r(e,t,n){return utils.isPlainObject(e)&&utils.isPlainObject(t)?utils.merge.call({caseless:n},e,t):utils.isPlainObject(t)?utils.merge({},t):utils.isArray(t)?t.slice():t}function o(e,t,n){return utils.isUndefined(t)?utils.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function i(e,t){if(!utils.isUndefined(t))return r(void 0,t)}function a(e,t){return utils.isUndefined(t)?utils.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,o,i){return i in t?r(n,o):i in e?r(void 0,n):void 0}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t)=>o(headersToObject(e),headersToObject(t),!0)};return utils.forEach(Object.keys(e).concat(Object.keys(t)),(function(r){const i=c[r]||o,a=i(e[r],t[r],r);utils.isUndefined(a)&&i!==s||(n[r]=a)})),n}const VERSION="1.3.4",validators$1={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{validators$1[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const deprecatedWarnings={};function assertOptions(e,t,n){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const i=r[o],a=t[i];if(a){const t=e[i],n=void 0===t||a(t,i,e);if(!0!==n)throw new AxiosError("option "+i+" must be "+n,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new AxiosError("Unknown option "+i,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,n){function r(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,i)=>{if(!1===e)throw new AxiosError(r(o," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[o]&&(deprecatedWarnings[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,i)}};const validator={assertOptions:assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(e){this.defaults=e,this.interceptors={request:new InterceptorManager$1,response:new InterceptorManager$1}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=mergeConfig(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;let i;void 0!==n&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),void 0!==r&&validator.assertOptions(r,{encode:validators.function,serialize:validators.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),i=o&&utils.merge(o.common,o[t.method]),i&&utils.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete o[e]})),t.headers=AxiosHeaders$1.concat(i,o);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,d=0;if(!s){const e=[dispatchRequest.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),l=e.length,u=Promise.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=a.length;let p=t;for(d=0;d<l;){const e=a[d++],t=a[d++];try{p=e(p)}catch(f){t.call(this,f);break}}try{u=dispatchRequest.call(this,p)}catch(f){return Promise.reject(f)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return buildURL(buildFullPath((e=mergeConfig(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}utils.forEach(["delete","get","head","options"],(function(e){Axios.prototype[e]=function(t,n){return this.request(mergeConfig(n||{},{method:e,url:t,data:(n||{}).data}))}})),utils.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,o){return this.request(mergeConfig(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Axios.prototype[e]=t(),Axios.prototype[e+"Form"]=t(!0)}));const Axios$1=Axios;class CancelToken{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,o){n.reason||(n.reason=new CanceledError(e,r,o),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new CancelToken((function(t){e=t})),cancel:e}}}const CancelToken$1=CancelToken;function spread(e){return function(t){return e.apply(null,t)}}function isAxiosError(e){return utils.isObject(e)&&!0===e.isAxiosError}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach((([e,t])=>{HttpStatusCode[t]=e}));const HttpStatusCode$1=HttpStatusCode;function createInstance(e){const t=new Axios$1(e),n=bind(Axios$1.prototype.request,t);return utils.extend(n,Axios$1.prototype,t,{allOwnKeys:!0}),utils.extend(n,t,null,{allOwnKeys:!0}),n.create=function(t){return createInstance(mergeConfig(e,t))},n}const axios=createInstance(defaults$1);axios.Axios=Axios$1,axios.CanceledError=CanceledError,axios.CancelToken=CancelToken$1,axios.isCancel=isCancel,axios.VERSION=VERSION,axios.toFormData=toFormData,axios.AxiosError=AxiosError,axios.Cancel=axios.CanceledError,axios.all=function(e){return Promise.all(e)},axios.spread=spread,axios.isAxiosError=isAxiosError,axios.mergeConfig=mergeConfig,axios.AxiosHeaders=AxiosHeaders$1,axios.formToJSON=e=>formDataToJSON(utils.isHTMLForm(e)?new FormData(e):e),axios.HttpStatusCode=HttpStatusCode$1,axios.default=axios;const axios$1=axios,factory=M.customLogFactory(S.LOG_LEVEL_INFO,"PluginSystem"),pluginSystemLogger=factory.getLogger("plugin system"),log=(...e)=>{pluginSystemLogger.info(...e)},request=axios$1.create({withCredentials:!1,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}}),sleep=async e=>new Promise((t=>{setTimeout((()=>t(null)),e)})),error=(...e)=>pluginSystemLogger.error(...e),genUUID=()=>([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(parseInt(e,10)^window.crypto.getRandomValues(new Uint32Array(1))[0]&15>>parseInt(e,10)/4).toString(16)));async function isExists(e){try{return null!==await FileClient.getInstanceApi().fileApi.getFile(e)}catch{return!1}}let Error$1=class{constructor(e){this.message=e}};class Warning{constructor(e){this.message=e}}const showErrorMessage=(e,t)=>new Notification({type:"error",message:e,timeout:t}).show(),getLogger=e=>factory.getLogger(e),langs={zh_CN:zh_CN,en_US:en_US},currentLang=window.siyuan.config.lang,lang=langs[currentLang]||en_US,_=e=>lang[e]||"not defined";var NAMED_TAG="named",NAME_TAG="name",UNMANAGED_TAG="unmanaged",OPTIONAL_TAG="optional",INJECT_TAG="inject",MULTI_INJECT_TAG="multi_inject",TAGGED="inversify:tagged",TAGGED_PROP="inversify:tagged_props",PARAM_TYPES="inversify:paramtypes",DESIGN_PARAM_TYPES="design:paramtypes",POST_CONSTRUCT="post_construct",PRE_DESTROY="pre_destroy";function getNonCustomTagKeys(){return[INJECT_TAG,MULTI_INJECT_TAG,NAME_TAG,UNMANAGED_TAG,NAMED_TAG,OPTIONAL_TAG]}var NON_CUSTOM_TAG_KEYS=getNonCustomTagKeys(),BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},idCounter=0;function id(){return idCounter++}var Binding=function(){function e(e,t){this.id=id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t},e}(),DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",NULL_ARGUMENT="NULL argument",KEY_NOT_FOUND="Key Not Found",AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",CANNOT_UNBIND="Could not unbind serviceIdentifier:",NOT_REGISTERED="No matching bindings found for serviceIdentifier:",MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},CIRCULAR_DEPENDENCY="Circular dependency found:",INVALID_BINDING_TYPE="Invalid binding type:",NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",LAZY_IN_SYNC=function(e){return"You are attempting to construct '"+e+"' in a synchronous way\n but it has asynchronous dependencies."},INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)",POST_CONSTRUCT_ERROR=function(e,t){return"@postConstruct error in class "+e+": "+t},PRE_DESTROY_ERROR=function(e,t){return"@preDestroy error in class "+e+": "+t},ON_DEACTIVATION_ERROR=function(e,t){return"onDeactivation() error in class "+e+": "+t},CIRCULAR_DEPENDENCY_IN_FACTORY=function(e,t){return"It looks like there is a circular dependency in one of the '"+e+"' bindings. Please investigate bindings withservice identifier '"+t+"'."},STACK_OVERFLOW="Maximum call stack size exceeded",MetadataReader=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(TAGGED_PROP,e)||[]},e}(),BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function isStackOverflowExeption(e){return e instanceof RangeError||e.message===STACK_OVERFLOW}var tryAndThrowErrorIfStackOverflow=function(e,t){try{return e()}catch(n){throw isStackOverflowExeption(n)&&(n=t()),n}};function getServiceIdentifierAsString(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function listRegisteredBindingsForServiceIdentifier(e,t,n){var r="",o=n(e,t);return 0!==o.length&&(r="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=getFunctionName(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r}function alreadyDependencyChain(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||alreadyDependencyChain(e.parentRequest,t))}function dependencyChainToString(e){var t=function e(t,n){void 0===n&&(n=[]);var r=getServiceIdentifierAsString(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e);return t.reverse().join(" --\x3e ")}function circularDependencyToException(e){e.childRequests.forEach((function(e){if(alreadyDependencyChain(e,e.serviceIdentifier)){var t=dependencyChainToString(e);throw new Error(CIRCULAR_DEPENDENCY+" "+t)}circularDependencyToException(e)}))}function listMetadataForTarget(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),o=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==o&&o.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e}function getFunctionName(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}function getSymbolDescription(e){return e.toString().slice(7,-1)}var Context=function(){function e(e){this.id=id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}(),Metadata=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},e}(),Plan=function(e,t){this.parentContext=e,this.rootRequest=t},LazyServiceIdentifer=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}(),QueryableString=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}(),Target=function(){function e(e,t,n,r){this.id=id(),this.type=e,this.serviceIdentifier=n;var o="symbol"==typeof t?getSymbolDescription(t):t;this.name=new QueryableString(o||""),this.identifier=t,this.metadata=new Array;var i=null;"string"==typeof r?i=new Metadata(NAMED_TAG,r):r instanceof Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var i=o[r];if(i.key===e&&i.value===n)return!0}return!1}},e}(),__spreadArray$2=globalThis&&globalThis.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function getDependencies(e,t){return getTargets(e,getFunctionName(t),t,!1)}function getTargets(e,t,n,r){var o=e.getConstructorMetadata(n),i=o.compilerGeneratedMetadata;if(void 0===i)throw new Error(MISSING_INJECTABLE_ANNOTATION+" "+t+".");var a=o.userGeneratedMetadata,s=Object.keys(a),c=0===n.length&&s.length>0,u=s.length>n.length,l=getConstructorArgsAsTargets(r,t,i,a,c||u?s.length:n.length),d=getClassPropsAsTargets(e,n,t);return __spreadArray$2(__spreadArray$2([],l,!0),d,!0)}function getConstructorArgsAsTarget(e,t,n,r,o){var i=o[e.toString()]||[],a=formatTargetMetadata(i),s=!0!==a.unmanaged,c=r[e],u=a.inject||a.multiInject;if((c=u||c)instanceof LazyServiceIdentifer&&(c=c.unwrap()),s){if(!t&&(c===Object||c===Function||void 0===c))throw new Error(MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".");var l=new Target(TargetTypeEnum.ConstructorArgument,a.targetName,c);return l.metadata=i,l}return null}function getConstructorArgsAsTargets(e,t,n,r,o){for(var i=[],a=0;a<o;a++){var s=getConstructorArgsAsTarget(a,e,t,n,r);null!==s&&i.push(s)}return i}function _getServiceIdentifierForProperty(e,t,n,r){var o=e||t;if(void 0===o){var i=MISSING_INJECTABLE_ANNOTATION+" for property "+String(n)+" in class "+r+".";throw new Error(i)}return o}function getClassPropsAsTargets(e,t,n){for(var r=e.getPropertiesMetadata(t),o=[],i=Object.getOwnPropertySymbols(r),a=0,s=Object.keys(r).concat(i);a<s.length;a++){var c=s[a],u=r[c],l=formatTargetMetadata(u),d=l.targetName||c,p=_getServiceIdentifierForProperty(l.inject,l.multiInject,c,n),f=new Target(TargetTypeEnum.ClassProperty,d,p);f.metadata=u,o.push(f)}var g=Object.getPrototypeOf(t.prototype).constructor;if(g!==Object){var h=getClassPropsAsTargets(e,g,n);o=__spreadArray$2(__spreadArray$2([],o,!0),h,!0)}return o}function getBaseClassDependencyCount(e,t){var n=Object.getPrototypeOf(t.prototype).constructor;if(n!==Object){var r=getTargets(e,getFunctionName(n),n,!0),o=r.map((function(e){return e.metadata.filter((function(e){return e.key===UNMANAGED_TAG}))})),i=[].concat.apply([],o).length,a=r.length-i;return a>0?a:getBaseClassDependencyCount(e,n)}return 0}function formatTargetMetadata(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[INJECT_TAG],multiInject:t[MULTI_INJECT_TAG],targetName:t[NAME_TAG],unmanaged:t[UNMANAGED_TAG]}}var Request=function(){function e(e,t,n,r,o){this.id=id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var o=new e(t,this.parentContext,this,n,r);return this.childRequests.push(o),o},e}();function getBindingDictionary(e){return e._bindingDictionary}function _createTarget(e,t,n,r,o,i){var a=new Metadata(e?MULTI_INJECT_TAG:INJECT_TAG,n),s=new Target(t,r,n,a);if(void 0!==o){var c=new Metadata(o,i);s.metadata.push(c)}return s}function _getActiveBindings(e,t,n,r,o){var i=getBindings(n.container,o.serviceIdentifier),a=[];return i.length===BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof o.serviceIdentifier&&e.getConstructorMetadata(o.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(o.serviceIdentifier).toSelf(),i=getBindings(n.container,o.serviceIdentifier)),a=t?i:i.filter((function(e){var t=new Request(e.serviceIdentifier,n,r,e,o);return e.constraint(t)})),_validateActiveBindingCount(o.serviceIdentifier,a,o,n.container),a}function _validateActiveBindingCount(e,t,n,r){switch(t.length){case BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var o=getServiceIdentifierAsString(e),i=NOT_REGISTERED;throw i+=listMetadataForTarget(o,n),i+=listRegisteredBindingsForServiceIdentifier(r,o,getBindings),new Error(i);case BindingCount.OnlyOneBindingAvailable:return t;case BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;o=getServiceIdentifierAsString(e),i=AMBIGUOUS_MATCH+" "+o;throw i+=listRegisteredBindingsForServiceIdentifier(r,o,getBindings),new Error(i)}}function _createSubRequests(e,t,n,r,o,i){var a,s;if(null===o){a=_getActiveBindings(e,t,r,null,i),s=new Request(n,r,null,a,i);var c=new Plan(r,s);r.addPlan(c)}else a=_getActiveBindings(e,t,r,o,i),s=o.addChildRequest(i.serviceIdentifier,a,i);a.forEach((function(t){var n=null;if(i.isArray())n=s.addChildRequest(t.serviceIdentifier,t,i);else{if(t.cache)return;n=s}if(t.type===BindingTypeEnum.Instance&&null!==t.implementationType){var o=getDependencies(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var a=getBaseClassDependencyCount(e,t.implementationType);if(o.length<a){var c=ARGUMENTS_LENGTH_MISMATCH(getFunctionName(t.implementationType));throw new Error(c)}}o.forEach((function(t){_createSubRequests(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function getBindings(e,t){var n=[],r=getBindingDictionary(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=getBindings(e.parent,t)),n}function plan(e,t,n,r,o,i,a,s){void 0===s&&(s=!1);var c=new Context(t),u=_createTarget(n,r,o,"",i,a);try{return _createSubRequests(e,s,o,c,null,u),c}catch(l){throw isStackOverflowExeption(l)&&circularDependencyToException(c.plan.rootRequest),l}}function createMockRequest(e,t,n,r){var o=new Target(TargetTypeEnum.Variable,"",t,new Metadata(n,r)),i=new Context(e);return new Request(t,i,null,[],o)}function isPromise(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function isPromiseOrContainsPromise(e){return!!isPromise(e)||Array.isArray(e)&&e.some(isPromise)}var __awaiter$3=globalThis&&globalThis.__awaiter||function(t,n,r,o){return new(r||(r=Promise))((function(i,a){function s(t){try{u(o.next(t))}catch(e){a(e)}}function c(t){try{u(o.throw(t))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((o=o.apply(t,n||[])).next())}))},__generator$3=globalThis&&globalThis.__generator||function(t,n){var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(e){a=[6,e],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},tryGetFromScope=function(e,t){return t.scope===BindingScopeEnum.Singleton&&t.activated?t.cache:t.scope===BindingScopeEnum.Request&&e.has(t.id)?e.get(t.id):null},saveToScope=function(e,t,n){t.scope===BindingScopeEnum.Singleton&&_saveToSingletonScope(t,n),t.scope===BindingScopeEnum.Request&&_saveToRequestScope(e,t,n)},_saveToRequestScope=function(e,t,n){e.has(t.id)||e.set(t.id,n)},_saveToSingletonScope=function(e,t){e.cache=t,e.activated=!0,isPromise(t)&&_saveAsyncResultToSingletonScope(e,t)},_saveAsyncResultToSingletonScope=function(e,t){return __awaiter$3(void 0,void 0,void 0,(function(){var n,r;return __generator$3(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t];case 1:return n=o.sent(),e.cache=n,[3,3];case 2:throw r=o.sent(),e.cache=null,e.activated=!1,r;case 3:return[2]}}))}))},FactoryType,FactoryType2;FactoryType2=FactoryType||(FactoryType={}),FactoryType2.DynamicValue="toDynamicValue",FactoryType2.Factory="toFactory",FactoryType2.Provider="toProvider";var ensureFullyBound=function(e){var t=null;switch(e.type){case BindingTypeEnum.ConstantValue:case BindingTypeEnum.Function:t=e.cache;break;case BindingTypeEnum.Constructor:case BindingTypeEnum.Instance:t=e.implementationType;break;case BindingTypeEnum.DynamicValue:t=e.dynamicValue;break;case BindingTypeEnum.Provider:t=e.provider;break;case BindingTypeEnum.Factory:t=e.factory}if(null===t){var n=getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(INVALID_BINDING_TYPE+" "+n)}},getFactoryDetails=function(e){switch(e.type){case BindingTypeEnum.Factory:return{factory:e.factory,factoryType:FactoryType.Factory};case BindingTypeEnum.Provider:return{factory:e.provider,factoryType:FactoryType.Provider};case BindingTypeEnum.DynamicValue:return{factory:e.dynamicValue,factoryType:FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+e.type)}},__assign$1=globalThis&&globalThis.__assign||function(){return __assign$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},__assign$1.apply(this,arguments)},__awaiter$2=globalThis&&globalThis.__awaiter||function(t,n,r,o){return new(r||(r=Promise))((function(i,a){function s(t){try{u(o.next(t))}catch(e){a(e)}}function c(t){try{u(o.throw(t))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((o=o.apply(t,n||[])).next())}))},__generator$2=globalThis&&globalThis.__generator||function(t,n){var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(e){a=[6,e],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},__spreadArray$1=globalThis&&globalThis.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function _resolveRequests(e,t){return e.reduce((function(e,n){var r=t(n);return n.target.type===TargetTypeEnum.ConstructorArgument?e.constructorInjections.push(r):(e.propertyRequests.push(n),e.propertyInjections.push(r)),e.isAsync||(e.isAsync=isPromiseOrContainsPromise(r)),e}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function _createInstance(e,t,n){var r;if(t.length>0){var o=_resolveRequests(t,n),i=__assign$1(__assign$1({},o),{constr:e});r=o.isAsync?createInstanceWithInjectionsAsync(i):createInstanceWithInjections(i)}else r=new e;return r}function createInstanceWithInjections(e){var t,n=new((t=e.constr).bind.apply(t,__spreadArray$1([void 0],e.constructorInjections,!1)));return e.propertyRequests.forEach((function(t,r){var o=t.target.identifier,i=e.propertyInjections[r];n[o]=i})),n}function createInstanceWithInjectionsAsync(e){return __awaiter$2(this,void 0,void 0,(function(){var t,n;return __generator$2(this,(function(r){switch(r.label){case 0:return[4,possiblyWaitInjections(e.constructorInjections)];case 1:return t=r.sent(),[4,possiblyWaitInjections(e.propertyInjections)];case 2:return n=r.sent(),[2,createInstanceWithInjections(__assign$1(__assign$1({},e),{constructorInjections:t,propertyInjections:n}))]}}))}))}function possiblyWaitInjections(e){return __awaiter$2(this,void 0,void 0,(function(){var t,n,r,o;return __generator$2(this,(function(i){for(t=[],n=0,r=e;n<r.length;n++)o=r[n],Array.isArray(o)?t.push(Promise.all(o)):t.push(o);return[2,Promise.all(t)]}))}))}function _getInstanceAfterPostConstruct(e,t){var n=_postConstruct(e,t);return isPromise(n)?n.then((function(){return t})):t}function _postConstruct(t,n){var r,o;if(Reflect.hasMetadata(POST_CONSTRUCT,t)){var i=Reflect.getMetadata(POST_CONSTRUCT,t);try{return null===(o=(r=n)[i.value])||void 0===o?void 0:o.call(r)}catch(e){throw new Error(POST_CONSTRUCT_ERROR(t.name,e.message))}}}function _validateInstanceResolution(e,t){e.scope!==BindingScopeEnum.Singleton&&_throwIfHandlingDeactivation(e,t)}function _throwIfHandlingDeactivation(e,t){var n="Class cannot be instantiated in "+(e.scope===BindingScopeEnum.Request?"request":"transient")+" scope.";if("function"==typeof e.onDeactivation)throw new Error(ON_DEACTIVATION_ERROR(t.name,n));if(Reflect.hasMetadata(PRE_DESTROY,t))throw new Error(PRE_DESTROY_ERROR(t.name,n))}function resolveInstance(e,t,n,r){_validateInstanceResolution(e,t);var o=_createInstance(t,n,r);return isPromise(o)?o.then((function(e){return _getInstanceAfterPostConstruct(t,e)})):_getInstanceAfterPostConstruct(t,o)}var __awaiter$1=globalThis&&globalThis.__awaiter||function(t,n,r,o){return new(r||(r=Promise))((function(i,a){function s(t){try{u(o.next(t))}catch(e){a(e)}}function c(t){try{u(o.throw(t))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((o=o.apply(t,n||[])).next())}))},__generator$1=globalThis&&globalThis.__generator||function(t,n){var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(e){a=[6,e],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},_resolveRequest=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,r=t.childRequests,o=t.target&&t.target.isArray(),i=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(o&&i)return r.map((function(t){return _resolveRequest(e)(t)}));if(!t.target.isOptional()||0!==n.length){var a=n[0];return _resolveBinding(e,t,a)}}},_resolveFactoryFromBinding=function(e,t){var n=getFactoryDetails(e);return tryAndThrowErrorIfStackOverflow((function(){return n.factory.bind(e)(t)}),(function(){return new Error(CIRCULAR_DEPENDENCY_IN_FACTORY(n.factoryType,t.currentRequest.serviceIdentifier.toString()))}))},_getResolvedFromBinding=function(e,t,n){var r,o=t.childRequests;switch(ensureFullyBound(n),n.type){case BindingTypeEnum.ConstantValue:case BindingTypeEnum.Function:r=n.cache;break;case BindingTypeEnum.Constructor:r=n.implementationType;break;case BindingTypeEnum.Instance:r=resolveInstance(n,n.implementationType,o,_resolveRequest(e));break;default:r=_resolveFactoryFromBinding(n,t.parentContext)}return r},_resolveInScope=function(e,t,n){var r=tryGetFromScope(e,t);return null!==r||(r=n(),saveToScope(e,t,r)),r},_resolveBinding=function(e,t,n){return _resolveInScope(e,n,(function(){var r=_getResolvedFromBinding(e,t,n);return r=isPromise(r)?r.then((function(e){return _onActivation(t,n,e)})):_onActivation(t,n,r)}))};function _onActivation(e,t,n){var r,o=_bindingActivation(e.parentContext,t,n),i=_getContainersIterator(e.parentContext.container),a=i.next();do{r=a.value;var s=e.parentContext,c=e.serviceIdentifier,u=_getContainerActivationsForService(r,c);o=isPromise(o)?_activateContainerAsync(u,s,o):_activateContainer(u,s,o),a=i.next()}while(!0!==a.done&&!getBindingDictionary(r).hasKey(e.serviceIdentifier));return o}var _bindingActivation=function(e,t,n){return"function"==typeof t.onActivation?t.onActivation(e,n):n},_activateContainer=function(e,t,n){for(var r=e.next();!r.done;){if(isPromise(n=r.value(t,n)))return _activateContainerAsync(e,t,n);r=e.next()}return n},_activateContainerAsync=function(e,t,n){return __awaiter$1(void 0,void 0,void 0,(function(){var r,o;return __generator$1(this,(function(i){switch(i.label){case 0:return[4,n];case 1:r=i.sent(),o=e.next(),i.label=2;case 2:return o.done?[3,4]:[4,o.value(t,r)];case 3:return r=i.sent(),o=e.next(),[3,2];case 4:return[2,r]}}))}))},_getContainerActivationsForService=function(e,t){var n=e._activations;return n.hasKey(t)?n.get(t).values():[].values()},_getContainersIterator=function(e){for(var t=[e],n=e.parent;null!==n;)t.push(n),n=n.parent;return{next:function(){var e=t.pop();return void 0!==e?{done:!1,value:e}:{done:!0,value:void 0}}}};function resolve(e){return _resolveRequest(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}var traverseAncerstors=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||traverseAncerstors(n,t))},taggedConstraint=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new Metadata(e,t),n}},namedConstraint=taggedConstraint(NAMED_TAG),typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}},BindingWhenSyntax=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=namedConstraint(e),new BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e&&(null!==e.target&&!e.target.isNamed()&&!e.target.isTagged())},new BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=taggedConstraint(e)(t),new BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return null!==t&&typeConstraint(e)(t.parentRequest)},new BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return null!==t&&namedConstraint(e)(t.parentRequest)},new BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&taggedConstraint(e)(t)(n.parentRequest)},new BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&traverseAncerstors(t,typeConstraint(e))},new BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&!traverseAncerstors(t,typeConstraint(e))},new BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&traverseAncerstors(t,namedConstraint(e))},new BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&!traverseAncerstors(t,namedConstraint(e))},new BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&traverseAncerstors(n,taggedConstraint(e)(t))},new BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&!traverseAncerstors(n,taggedConstraint(e)(t))},new BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&traverseAncerstors(t,e)},new BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&!traverseAncerstors(t,e)},new BindingOnSyntax(this._binding)},e}(),BindingOnSyntax=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new BindingWhenSyntax(this._binding)},e.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new BindingWhenSyntax(this._binding)},e}(),BindingWhenOnSyntax=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new BindingWhenSyntax(this._binding),this._bindingOnSyntax=new BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),BindingInSyntax=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=BindingScopeEnum.Request,new BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=BindingScopeEnum.Transient,new BindingWhenOnSyntax(this._binding)},e}(),BindingInWhenOnSyntax=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new BindingWhenSyntax(this._binding),this._bindingOnSyntax=new BindingOnSyntax(this._binding),this._bindingInSyntax=new BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),BindingToSyntax=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=BindingTypeEnum.Instance,this._binding.implementationType=e,new BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=BindingTypeEnum.Function,this._binding.scope=BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.toAutoNamedFactory=function(e){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}(),ContainerSnapshot=function(){function e(){}return e.of=function(t,n,r,o,i){var a=new e;return a.bindings=t,a.middleware=n,a.deactivations=o,a.activations=r,a.moduleActivationStore=i,a},e}();function isClonable(e){return"object"==typeof e&&null!==e&&"clone"in e&&"function"==typeof e.clone}var Lookup=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(NULL_ARGUMENT);if(null==t)throw new Error(NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?n.push(t):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(KEY_NOT_FOUND)},e.prototype.removeIntersection=function(e){var t=this;this.traverse((function(n,r){var o=e.hasKey(n)?e.get(n):void 0;if(void 0!==o){var i=r.filter((function(e){return!o.some((function(t){return e===t}))}));t._setValue(n,i)}}))},e.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach((function(r,o){for(var i=[],a=0,s=r;a<s.length;a++){var c=s[a];e(c)?n.push(c):i.push(c)}t._setValue(o,i)})),n},e.prototype.hasKey=function(e){if(null==e)throw new Error(NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,isClonable(e)?e.clone():e)}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},e}(),ModuleActivationStore=function(){function e(){this._map=new Map}return e.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},e.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},e.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){t._map.set(n,{onActivations:e.onActivations.clone(),onDeactivations:e.onDeactivations.clone()})})),t},e.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return void 0===t&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},e.prototype._getEmptyHandlersStore=function(){return{onActivations:new Lookup,onDeactivations:new Lookup}},e}(),__assign=globalThis&&globalThis.__assign||function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},__assign.apply(this,arguments)},__awaiter=globalThis&&globalThis.__awaiter||function(t,n,r,o){return new(r||(r=Promise))((function(i,a){function s(t){try{u(o.next(t))}catch(e){a(e)}}function c(t){try{u(o.throw(t))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}u((o=o.apply(t,n||[])).next())}))},__generator=globalThis&&globalThis.__generator||function(t,n){var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(t,s)}catch(e){a=[6,e],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},__spreadArray=globalThis&&globalThis.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Container=function(){function t(e){var t=e||{};if("object"!=typeof t)throw new Error(""+CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=BindingScopeEnum.Transient;else if(t.defaultScope!==BindingScopeEnum.Singleton&&t.defaultScope!==BindingScopeEnum.Transient&&t.defaultScope!==BindingScopeEnum.Request)throw new Error(""+CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=id(),this._bindingDictionary=new Lookup,this._snapshots=[],this._middleware=null,this._activations=new Lookup,this._deactivations=new Lookup,this.parent=null,this._metadataReader=new MetadataReader,this._moduleActivationStore=new ModuleActivationStore}return t.merge=function(e,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=new t,a=__spreadArray([e,n],r,!0).map((function(e){return getBindingDictionary(e)})),s=getBindingDictionary(i);return a.forEach((function(e){var t;t=s,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),i},t.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var i=o[r],a=n(i.id);i.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},t.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return __awaiter(this,void 0,void 0,(function(){var t,n,r,o,i;return __generator(this,(function(a){switch(a.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,a.label=1;case 1:return n<r.length?(o=r[n],i=t(o.id),[4,o.registry(i.bindFunction,i.unbindFunction,i.isboundFunction,i.rebindFunction,i.unbindAsyncFunction,i.onActivationFunction,i.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n=e._removeModuleBindings(t.id);e._deactivateSingletons(n),e._removeModuleHandlers(t.id)}))},t.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return __awaiter(this,void 0,void 0,(function(){var t,n,r,o;return __generator(this,(function(i){switch(i.label){case 0:t=0,n=e,i.label=1;case 1:return t<n.length?(r=n[t],o=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(o)]):[3,4];case 2:i.sent(),this._removeModuleHandlers(r.id),i.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype.bind=function(e){var t=this.options.defaultScope||BindingScopeEnum.Transient,n=new Binding(e,t);return this._bindingDictionary.add(e,n),new BindingToSyntax(n)},t.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},t.prototype.rebindAsync=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}}))}))},t.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},t.prototype.unbindAsync=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}}))}))},t.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse((function(t,n){e._deactivateSingletons(n)})),this._bindingDictionary=new Lookup},t.prototype.unbindAllAsync=function(){return __awaiter(this,void 0,void 0,(function(){var e,t=this;return __generator(this,(function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse((function(n,r){e.push(t._deactivateSingletonsAsync(r))})),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new Lookup,[2]}}))}))},t.prototype.onActivation=function(e,t){this._activations.add(e,t)},t.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},t.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},t.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},t.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,NAMED_TAG,t)},t.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),i=createMockRequest(this,e,t,n);r=o.some((function(e){return e.constraint(i)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},t.prototype.snapshot=function(){this._snapshots.push(ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},t.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},t.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},t.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},t.prototype.getAsync=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]}))}))},t.prototype.getTagged=function(e,t,n){var r=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(r)},t.prototype.getTaggedAsync=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(o){return r=this._getNotAllArgs(e,!1,t,n),[2,this._get(r)]}))}))},t.prototype.getNamed=function(e,t){return this.getTagged(e,NAMED_TAG,t)},t.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,NAMED_TAG,t)},t.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},t.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},t.prototype.getAllTagged=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(r)},t.prototype.getAllTaggedAsync=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getAll(r)},t.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,NAMED_TAG,t)},t.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,NAMED_TAG,t)},t.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},t.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(PRE_DESTROY,e))return t[Reflect.getMetadata(PRE_DESTROY,e).value]()},t.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},t.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition((function(t){return t.moduleId===e}))},t.prototype._deactivate=function(e,t){var n=this,r=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(isPromise(o))return this._handleDeactivationError(o.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)})),r)}var i=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(isPromise(i))return this._handleDeactivationError(i,r)}catch(a){throw new Error(ON_DEACTIVATION_ERROR(r.name,a.message))}},t.prototype._handleDeactivationError=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e];case 1:return r.sent(),[3,3];case 2:throw n=r.sent(),new Error(ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}}))}))},t.prototype._deactivateContainer=function(e,t){for(var n=this,r=t.next();r.value;){var o=r.value(e);if(isPromise(o))return o.then((function(){return n._deactivateContainerAsync(e,t)}));r=t.next()}},t.prototype._deactivateContainerAsync=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:n=t.next(),r.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return r.sent(),n=t.next(),[3,1];case 3:return[2]}}))}))},t.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var o=e.rebind(r);return t(o,n),o}},r=function(t){return function(n,r){e._moduleActivationStore.addActivation(t,n,r),e.onActivation(n,r)}},o=function(t){return function(n,r){e._moduleActivationStore.addDeactivation(t,n,r),e.onDeactivation(n,r)}};return function(i){return{bindFunction:(a=i,function(n){var r=e.bind(n);return t(r,a),r}),isboundFunction:function(t){return e.isBound(t)},onActivationFunction:r(i),onDeactivationFunction:o(i),rebindFunction:n(i),unbindFunction:function(t){return e.unbind(t)},unbindAsyncFunction:function(t){return e.unbindAsync(t)}};var a}},t.prototype._getAll=function(e){return Promise.all(this._get(e))},t.prototype._get=function(e){var t=__assign(__assign({},e),{contextInterceptor:function(e){return e},targetType:TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(null==n)throw new Error(INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},t.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if(isPromiseOrContainsPromise(t))throw new Error(LAZY_IN_SYNC(e.serviceIdentifier));return t},t.prototype._getAllArgs=function(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}},t.prototype._getNotAllArgs=function(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}},t.prototype._planAndResolve=function(){var e=this;return function(t){var n=plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return resolve(n=t.contextInterceptor(n))}},t.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return isPromise(e.cache)?e.cache.then((function(n){return t._deactivate(e,n)})):this._deactivate(e,e.cache)},t.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(isPromise(this._deactivateIfSingleton(r)))throw new Error(ASYNC_UNBIND_REQUIRED)}},t.prototype._deactivateSingletonsAsync=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t._deactivateIfSingleton(e)})))];case 1:return n.sent(),[2]}}))}))},t.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},t.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},t.prototype._removeServiceFromDictionary=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(CANNOT_UNBIND+" "+getServiceIdentifierAsString(t))}},t.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var r=this;if("function"==typeof e.onDeactivation){var o=e.onDeactivation(t);if(isPromise(o))return o.then((function(){return r._preDestroy(n,t)}))}return this._preDestroy(n,t)},t.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return"function"!=typeof e.onDeactivation?[3,2]:[4,e.onDeactivation(t)];case 1:r.sent(),r.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return r.sent(),[2]}}))}))},t}();function getFirstArrayDuplicate(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var o=r[n];if(t.has(o))return o;t.add(o)}}function targetIsConstructorFunction(e){return void 0!==e.prototype}function _throwIfMethodParameter(e){if(void 0!==e)throw new Error(INVALID_DECORATOR_OPERATION)}function tagParameter(e,t,n,r){_throwIfMethodParameter(t),_tagParameterOrProperty(TAGGED,e,n.toString(),r)}function tagProperty(e,t,n){if(targetIsConstructorFunction(e))throw new Error(INVALID_DECORATOR_OPERATION);_tagParameterOrProperty(TAGGED_PROP,e.constructor,t,n)}function _ensureNoMetadataKeyDuplicates(e){var t=[];if(Array.isArray(e)){var n=getFirstArrayDuplicate((t=e).map((function(e){return e.key})));if(void 0!==n)throw new Error(DUPLICATED_METADATA+" "+n.toString())}else t=[e];return t}function _tagParameterOrProperty(e,t,n,r){var o=_ensureNoMetadataKeyDuplicates(r),i={};Reflect.hasOwnMetadata(e,t)&&(i=Reflect.getMetadata(e,t));var a=i[n];if(void 0===a)a=[];else for(var s=function(e){if(o.some((function(t){return t.key===e.key})))throw new Error(DUPLICATED_METADATA+" "+e.key.toString())},c=0,u=a;c<u.length;c++){s(u[c])}a.push.apply(a,o),i[n]=a,Reflect.defineMetadata(e,i,t)}function createTaggedDecorator(e){return function(t,n,r){"number"==typeof r?tagParameter(t,n,r,e):tagProperty(t,n,e)}}function injectable(){return function(e){if(Reflect.hasOwnMetadata(PARAM_TYPES,e))throw new Error(DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(PARAM_TYPES,t,e),e}}function injectBase(e){return function(t){return function(n,r,o){if(void 0===t){var i="function"==typeof n?n.name:n.constructor.name;throw new Error(UNDEFINED_INJECT_ANNOTATION(i))}return createTaggedDecorator(new Metadata(e,t))(n,r,o)}}}var inject=injectBase(INJECT_TAG);const PLUGIN_SYSTEM_AUTO_UPDATE="PLUGIN_SYSTEM_AUTO_UPDATE",PLUGIN_SYSTEM_PLUGIN="PLUGIN_SYSTEM_PLUGIN",PLUGIN_SYSTEM_THIRD_PARTY_PLUGIN="PLUGIN_SYSTEM_THIRD_PARTY_PLUGIN",PLUGIN_SYSTEM_SAFE_MODE_ENABLED="PLUGIN_SYSTEM_SAFE_MODE_ENABLED",PLUGIN_STORE_URL="PLUGIN_STORE_URL",defaultConfig={[PLUGIN_SYSTEM_SAFE_MODE_ENABLED]:!0,[PLUGIN_SYSTEM_AUTO_UPDATE]:!0,[PLUGIN_SYSTEM_PLUGIN]:[{key:"setting",enabled:!0}],[PLUGIN_SYSTEM_THIRD_PARTY_PLUGIN]:[],[PLUGIN_STORE_URL]:"https://bitbucket.org/hi-windom/sillot-plugins/raw/main/"};function noop(){}function assign(e,t){for(const n in t)e[n]=t[n];return e}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return"function"==typeof e}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function is_empty(e){return 0===Object.keys(e).length}function create_slot(e,t,n,r){if(e){const o=get_slot_context(e,t,n,r);return e[0](o)}}function get_slot_context(e,t,n,r){return e[1]&&r?assign(n.ctx.slice(),e[1](r(t))):n.ctx}function get_slot_changes(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}function update_slot_base(e,t,n,r,o,i){if(o){const a=get_slot_context(t,n,r,i);e.p(a,o)}}function get_all_dirty_from_scope(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function null_to_empty(e){return null==e?"":e}function append(e,t){e.appendChild(t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode&&e.parentNode.removeChild(e)}function destroy_each(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function empty(){return text("")}function listen(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function attr(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xlink_attr(e,t,n){e.setAttributeNS("http://www.w3.org/1999/xlink",t,n)}function children(e){return Array.from(e.childNodes)}function set_data(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function set_input_value(e,t){e.value=null==t?"":t}function set_style(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function custom_event(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}class HtmlTag{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=svg_element(t.nodeName):this.e=element(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)insert(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(detach)}}function construct_svelte_component(e,t){return new e(t)}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}function createEventDispatcher(){const e=get_current_component();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=custom_event(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(0!==flushidx)return;const t=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(t)}function update(e){if(null!==e.fragment){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function transition_out(e,t,n,r){if(e&&e.o){if(outroing.has(e))return;outroing.add(e),outros.c.push((()=>{outroing.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}function create_component(e){e&&e.c()}function mount_component(e,t,n,r){const{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),r||add_render_callback((()=>{const t=e.$$.on_mount.map(run).filter(is_function);e.$$.on_destroy?e.$$.on_destroy.push(...t):run_all(t),e.$$.on_mount=[]})),i.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;null!==n.fragment&&(run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){-1===e.$$.dirty[0]&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,n,r,o,i,a,s=[-1]){const c=current_component;set_current_component(e);const u=e.$$={fragment:null,ctx:[],props:i,update:noop,not_equal:o,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:blank_object(),dirty:s,skip_bound:!1,root:t.target||c.$$.root};a&&a(u.root);let l=!1;if(u.ctx=n?n(e,t.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return u.ctx&&o(u.ctx[t],u.ctx[t]=i)&&(!u.skip_bound&&u.bound[t]&&u.bound[t](i),l&&make_dirty(e,t)),n})):[],u.update(),l=!0,run_all(u.before_update),u.fragment=!!r&&r(u.ctx),t.target){if(t.hydrate){const e=children(t.target);u.fragment&&u.fragment.l(e),e.forEach(detach)}else u.fragment&&u.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor,t.customElement),flush()}set_current_component(c)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){if(!is_function(t))return noop;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const commandPanel_svelte_svelte_type_style_lang="";function get_each_context$4(e,t,n){const r=e.slice();return r[11]=t[n],r[13]=n,r}function create_if_block$5(e){let t,n=e[2],r=[];for(let o=0;o<n.length;o+=1)r[o]=create_each_block$4(get_each_context$4(e,n,o));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=empty()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);insert(e,t,n)},p(e,o){if(22&o){let i;for(n=e[2],i=0;i<n.length;i+=1){const a=get_each_context$4(e,n,i);r[i]?r[i].p(a,o):(r[i]=create_each_block$4(a),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){destroy_each(r,e),e&&detach(t)}}}function create_if_block_1$4(e){let t,n,r,o,i=_("shortcut")+"",a=e[11].shortcut+"";return{c(){t=element("div"),n=text(i),r=text(": "),o=text(a),attr(t,"class","command-shortcut svelte-1bq7axd")},m(e,i){insert(e,t,i),append(t,n),append(t,r),append(t,o)},p(e,t){4&t&&a!==(a=e[11].shortcut+"")&&set_data(o,a)},d(e){e&&detach(t)}}}function create_each_block$4(e){let t,n,r,o,i,a,s,c,u,l,d,p,f,g,h,_=e[11].pluginName+"",y=e[11].command+"",m=(e[11].description||"")+"",v=e[11].shortcut&&create_if_block_1$4(e);function b(){return e[7](e[13])}return{c(){t=element("div"),n=element("span"),r=text(_),o=space(),i=text(":"),a=space(),s=element("span"),c=text(y),u=space(),l=text(m),d=space(),v&&v.c(),p=space(),attr(n,"class","command-plugin svelte-1bq7axd"),attr(s,"class","command-description"),attr(t,"class",f=null_to_empty(e[13]===e[1]?"command-selected command":"command")+" svelte-1bq7axd")},m(e,f){insert(e,t,f),append(t,n),append(n,r),append(n,o),append(n,i),append(t,a),append(t,s),append(s,c),append(s,u),append(s,l),append(t,d),v&&v.m(t,null),append(t,p),g||(h=listen(t,"click",b),g=!0)},p(n,o){e=n,4&o&&_!==(_=e[11].pluginName+"")&&set_data(r,_),4&o&&y!==(y=e[11].command+"")&&set_data(c,y),4&o&&m!==(m=(e[11].description||"")+"")&&set_data(l,m),e[11].shortcut?v?v.p(e,o):(v=create_if_block_1$4(e),v.c(),v.m(t,p)):v&&(v.d(1),v=null),2&o&&f!==(f=null_to_empty(e[13]===e[1]?"command-selected command":"command")+" svelte-1bq7axd")&&attr(t,"class",f)},d(e){e&&detach(t),v&&v.d(),g=!1,h()}}}function create_fragment$7(e){let t,n,r,o,i,a,s,c,u,l=e[2]&&create_if_block$5(e);return{c(){t=element("div"),n=element("div"),r=svg_element("svg"),o=svg_element("path"),i=space(),a=element("input"),s=space(),l&&l.c(),attr(o,"d","M64 112v800h896V112H64z m846 750H114V162h796v700zM234.6 688.8L411.3 512 234.6 335.2l35.4-35.4L482.1 512 269.9 724.1l-35.3-35.3z m554.8-10.2h-300v-50h300v50z"),set_style(r,"left","14px"),attr(r,"class","b3-form__icon-icon"),attr(r,"viewBox","0 0 1024 1024"),attr(r,"version","1.1"),attr(r,"xmlns","http://www.w3.org/2000/svg"),attr(r,"width","200"),attr(r,"height","200"),attr(a,"id","commandPanelInput"),attr(a,"class","b3-text-field b3-text-field--text fn__block b3-form__icon-input"),attr(n,"class","b3-form__icon search__header"),attr(t,"class","fn__flex-column"),set_style(t,"border-radius","4px"),set_style(t,"overflow","hidden"),set_style(t,"position","relative"),set_style(t,"width","max(80vw, 1000px)")},m(d,p){insert(d,t,p),append(t,n),append(n,r),append(r,o),append(n,i),append(n,a),set_input_value(a,e[0]),append(t,s),l&&l.m(t,null),c||(u=[listen(a,"input",e[6]),listen(a,"keydown",e[3])],c=!0)},p(e,[n]){1&n&&a.value!==e[0]&&set_input_value(a,e[0]),e[2]?l?l.p(e,n):(l=create_if_block$5(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i:noop,o:noop,d(e){e&&detach(t),l&&l.d(),c=!1,run_all(u)}}}function instance$7(e,t,n){const r=container.get("CommandManager");let o=[],i="",a=0,s=[];const c=()=>{const e=s[a];Dialog.destroyAll(),e.callback()},u=e=>{n(1,a=e),c()},l=(e,t)=>e&&e.toLowerCase().indexOf(t.toLowerCase())>=0;onMount((()=>{n(5,o=r.getCommands());document.getElementById("commandPanelInput").focus()}));return e.$$.update=()=>{33&e.$$.dirty&&(n(1,a=0),n(2,s=i?o.filter((e=>l(e.plugin,i)||l(e.pluginName,i)||l(e.command,i)||l(e.description,i))):o))},[i,a,s,e=>{if(13!==e.keyCode)if(38!==e.keyCode){if(40===e.keyCode){const t=s.length;if(e.preventDefault(),a>=t-1)return;n(1,a++,a)}}else{if(e.preventDefault(),0===a)return;n(1,a--,a)}else c()},u,o,function(){i=this.value,n(0,i)},e=>u(e)]}class Command_panel extends SvelteComponent{constructor(e){super(),init(this,e,instance$7,create_fragment$7,safe_not_equal,{})}}class CommandPanelPlugin extends Plugin{onload(){this.registerCommand({command:"Show command panel",description:_("show_command_panel"),shortcut:"ctrl+shift+o,command+shift+o",callback:()=>{this.showPanel()}})}showPanel(){Dialog.destroyAll(),new Dialog({content:'<div id="command-panel"></div>'}),setImmediate((()=>{new Command_panel({target:document.getElementById("command-panel")})}))}}function get_each_context$3(e,t,n){const r=e.slice();return r[5]=t[n],r[6]=t,r[7]=n,r}function create_if_block_1$3(e){let t,n,r;function o(){e[2].call(t,e[6],e[7])}return{c(){t=element("input"),attr(t,"class","b3-text-field fn__flex-center fn__size200"),attr(t,"type","input")},m(i,a){insert(i,t,a),set_input_value(t,e[5].value),n||(r=[listen(t,"input",o),listen(t,"change",(function(){is_function(e[5].onChange)&&e[5].onChange.apply(this,arguments)}))],n=!0)},p(n,r){e=n,1&r&&set_input_value(t,e[5].value)},d(e){e&&detach(t),n=!1,run_all(r)}}}function create_if_block$4(e){let t,n,r;function o(){e[1].call(t,e[6],e[7])}return{c(){t=element("input"),attr(t,"class","b3-switch fn__flex-center"),attr(t,"type","checkbox")},m(i,a){insert(i,t,a),t.checked=e[5].checked,n||(r=[listen(t,"change",o),listen(t,"change",(function(){is_function(e[5].onChange)&&e[5].onChange.apply(this,arguments)}))],n=!0)},p(n,r){e=n,1&r&&(t.checked=e[5].checked)},d(e){e&&detach(t),n=!1,run_all(r)}}}function create_each_block$3(e){let t,n,r,o,i,a,s,c,u,l,d=e[5].label+"",p=e[5].tip+"";function f(e,t){return"checkbox"===e[5].type?create_if_block$4:"input"===e[5].type?create_if_block_1$3:void 0}let g=f(e),h=g&&g(e);return{c(){t=element("label"),n=element("div"),r=text(d),o=space(),i=element("div"),a=text(p),s=space(),c=element("span"),u=space(),h&&h.c(),l=space(),attr(i,"class","b3-label__text"),attr(n,"class","fn__flex-1"),attr(c,"class","fn__space"),attr(t,"class","fn__flex b3-label config__item")},m(e,d){insert(e,t,d),append(t,n),append(n,r),append(n,o),append(n,i),append(i,a),append(t,s),append(t,c),append(t,u),h&&h.m(t,null),append(t,l)},p(e,n){1&n&&d!==(d=e[5].label+"")&&set_data(r,d),1&n&&p!==(p=e[5].tip+"")&&set_data(a,p),g===(g=f(e))&&h?h.p(e,n):(h&&h.d(1),h=g&&g(e),h&&(h.c(),h.m(t,l)))},d(e){e&&detach(t),h&&h.d()}}}function create_fragment$6(e){let t,n=e[0],r=[];for(let o=0;o<n.length;o+=1)r[o]=create_each_block$3(get_each_context$3(e,n,o));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=empty()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);insert(e,t,n)},p(e,[o]){if(1&o){let i;for(n=e[0],i=0;i<n.length;i+=1){const a=get_each_context$3(e,n,i);r[i]?r[i].p(a,o):(r[i]=create_each_block$3(a),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:noop,o:noop,d(e){destroy_each(r,e),e&&detach(t)}}}function instance$6(e,t,n){const r=container.get(TYPES.StorageManager),o=container.get(TYPES.PluginSystem);let i=[{label:_("safemode"),tip:_("safemodetip"),checked:!0,type:"checkbox",onChange:e=>{e.target.checked?o.turnOnSafeMode():o.turnOffSafeMode()}},{label:_("autoupgrade"),tip:_("autoupgradetip"),checked:!0,type:"checkbox",onChange:e=>{r.set(PLUGIN_SYSTEM_AUTO_UPDATE,e.target.checked)}},{label:_("store_url"),tip:`${_("store_url_tip")} ${defaultConfig.PLUGIN_STORE_URL}`,type:"input",value:r.get(PLUGIN_STORE_URL),onChange:e=>{r.set(PLUGIN_STORE_URL,e.target.value)}}];return onMount((()=>{const e=r.get(PLUGIN_SYSTEM_SAFE_MODE_ENABLED);n(0,i[0].checked=e,i);const t=r.get(PLUGIN_SYSTEM_AUTO_UPDATE);n(0,i[1].checked=t,i)})),[i,function(e,t){e[t].checked=this.checked,n(0,i)},function(e,t){e[t].value=this.value,n(0,i)}]}class Setting_common extends SvelteComponent{constructor(e){super(),init(this,e,instance$6,create_fragment$6,safe_not_equal,{})}}const settingList_svelte_svelte_type_style_lang="";function get_each_context$2(e,t,n){const r=e.slice();return r[10]=t[n],r[11]=t,r[12]=n,r}function create_if_block$3(e){let t,n,r,o,i,a,s,c,u,l,d,p,f,g,h,y,m,v=e[10].name+"",b=e[10].version+"",w=(e[10].description||_("nodescription"))+"";function S(...t){return e[4](e[10],...t)}function E(){e[5].call(g,e[11],e[12])}return{c(){t=element("label"),n=element("div"),r=text(v),o=space(),i=text(b),a=space(),s=element("span"),s.textContent=`${_("uninstall")}`,c=space(),u=element("div"),l=text(w),d=space(),p=element("span"),f=space(),g=element("input"),h=space(),attr(s,"class","remove svelte-bwhxpp"),attr(u,"class","b3-label__text"),attr(n,"class","plugin fn__flex-1 svelte-bwhxpp"),attr(p,"class","fn__space"),attr(g,"class","b3-switch fn__flex-center"),attr(g,"id","fullWidth"),attr(g,"type","checkbox"),attr(t,"class","fn__flex b3-label")},m(_,v){insert(_,t,v),append(t,n),append(n,r),append(n,o),append(n,i),append(n,a),append(n,s),append(n,c),append(n,u),append(u,l),append(t,d),append(t,p),append(t,f),append(t,g),g.checked=e[10].enabled,append(t,h),y||(m=[listen(s,"click",S),listen(g,"change",E),listen(g,"change",(function(){is_function(e[1](e[10].key))&&e[1](e[10].key).apply(this,arguments)}))],y=!0)},p(t,n){e=t,1&n&&v!==(v=e[10].name+"")&&set_data(r,v),1&n&&b!==(b=e[10].version+"")&&set_data(i,b),1&n&&w!==(w=(e[10].description||_("nodescription"))+"")&&set_data(l,w),1&n&&(g.checked=e[10].enabled)},d(e){e&&detach(t),y=!1,run_all(m)}}}function create_each_block$2(e){let t,n=!e[10].hidden&&create_if_block$3(e);return{c(){n&&n.c(),t=empty()},m(e,r){n&&n.m(e,r),insert(e,t,r)},p(e,r){e[10].hidden?n&&(n.d(1),n=null):n?n.p(e,r):(n=create_if_block$3(e),n.c(),n.m(t.parentNode,t))},d(e){n&&n.d(e),e&&detach(t)}}}function create_fragment$5(e){let t,n,r=e[0],o=[];for(let i=0;i<r.length;i+=1)o[i]=create_each_block$2(get_each_context$2(e,r,i));return{c(){t=element("label"),n=element("div");for(let e=0;e<o.length;e+=1)o[e].c();attr(n,"class","fn__flex-1"),attr(t,"class","b3-label fn__flex")},m(e,r){insert(e,t,r),append(t,n);for(let t=0;t<o.length;t+=1)o[t].m(n,null)},p(e,[t]){if(7&t){let i;for(r=e[0],i=0;i<r.length;i+=1){const a=get_each_context$2(e,r,i);o[i]?o[i].p(a,t):(o[i]=create_each_block$2(a),o[i].c(),o[i].m(n,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},i:noop,o:noop,d(e){e&&detach(t),destroy_each(o,e)}}}function instance$5(e,t,n){let r;const o=container.get(TYPES.StorageManager),i=container.get(TYPES.PluginSystem);let a=[];const s=()=>{n(3,a=o.getPlugins())},c=createEventDispatcher(),u=async(e,t)=>{t.preventDefault(),t.stopPropagation(),await i.unloadPlugin(e),await o.uninstallPlugin(e),await o.initStorage(),s()};onMount((async()=>{await o.initStorage(),s()}));return e.$$.update=()=>{8&e.$$.dirty&&n(0,r=a.filter((e=>e.script)))},[r,e=>async t=>{const n=o.get(PLUGIN_SYSTEM_SAFE_MODE_ENABLED),r=t.target.checked;await o.setPluginEnabled(e,r),n||(r?i.loadPlugin(e):i.unloadPlugin(e),c("update"))},u,a,(e,t)=>u(e.key,t),function(e,t){e[t].enabled=this.checked,n(0,r),n(3,a)}]}class Setting_list extends SvelteComponent{constructor(e){super(),init(this,e,instance$5,create_fragment$5,safe_not_equal,{})}}var __defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$9(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$9(t,n,i),i},__decorateParam$6=(e,t)=>(n,r)=>t(n,r,e);let Store=class{constructor(e){this.storageManager=e,this.plugins=[],this.pluginStatus=[]}async init(){this.plugins=[],this.pluginStatus=[],await Promise.all([this.loadPluginsFromUrl(),this.storageManager.initStorage()]);const e=this.storageManager.getPlugins(),t=[];for(const n of this.plugins){const r={...n,isExist:!1,needUpgrade:!1};e.find((e=>e.key===n.key)),t.push(r)}this.pluginStatus=t}getStoreUrl(){return this.storageManager.get(PLUGIN_STORE_URL)}getPlugins(){return this.plugins}async loadPlugins(){return await this.init(),this.getPluginsWithStatus()}getPluginsWithStatus(){return this.pluginStatus}async loadPluginsFromUrl(){var t,n;const r=this.getStoreUrl();if(!r)return;let o;try{o=await request.get(r+"/plugins.json",{headers:{"Cache-Control":"no-cache"}})}catch(e){return void console.error(e)}const i=[];if(Array.isArray(null==(t=o.data)?void 0:t.plugins))for(const e of(null==(n=o.data)?void 0:n.plugins)||{}){const t=this.getPluginManifest(`${r}/${e}`);i.push(t)}this.plugins=await Promise.all(i)}async getPluginByUrl(e){return Promise.all([this.getPluginManifest(e),this.getPluginMainJs(e)]).then((e=>({manifest:e[0],mainJs:e[1]})))}async getPluginManifest(t){try{return(await request.get(`${t}/manifest.json`,{headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}})).data}catch(e){return console.error(e),null}}async getPluginMainJs(t){try{return(await request.get(`${t}/main.js`,{headers:{"Content-Type":"text/plain","Cache-Control":"no-cache"}})).data}catch(e){return console.error(e),null}}async getPluginReadme(t){const n=`${this.getStoreUrl()}/${t}`;try{return(await request.get(`${n}/README.md`,{headers:{"Content-Type":"text/plain","Cache-Control":"no-cache"}})).data}catch(e){return console.error(e),null}}async downloadPlugin(e){await sleep(500);const t=await this.getPluginByUrl(`${this.getStoreUrl()}/${e}`),n=t.manifest,r=t.mainJs;return await Promise.all([FileClient.getInstanceApi().fileApi.putFile(`/data/plugins/${e}`,null,!0),FileClient.getInstanceApi().fileApi.putFile(`/data/plugins/${e}/manifest.json`,JSON.stringify(n),!1),FileClient.getInstanceApi().fileApi.putFile(`/data/plugins/${e}/main.js`,r,!1)])}};function create_fragment$4(e){let t,n,r,o;const i=e[3].default,a=create_slot(i,e,e[2],null);return{c(){t=element("button"),a&&a.c(),t.disabled=e[1],attr(t,"class","b3-button")},m(i,s){insert(i,t,s),a&&a.m(t,null),n=!0,r||(o=listen(t,"click",(function(){is_function(e[0])&&e[0].apply(this,arguments)})),r=!0)},p(r,[o]){e=r,a&&a.p&&(!n||4&o)&&update_slot_base(a,i,e,e[2],n?get_slot_changes(i,e[2],o,null):get_all_dirty_from_scope(e[2]),null),(!n||2&o)&&(t.disabled=e[1])},i(e){n||(transition_in(a,e),n=!0)},o(e){transition_out(a,e),n=!1},d(e){e&&detach(t),a&&a.d(e),r=!1,o()}}}function instance$4(e,t,n){let{$$slots:r={},$$scope:o}=t,{onClick:i=null}=t,{disabled:a=!1}=t;return e.$$set=e=>{"onClick"in e&&n(0,i=e.onClick),"disabled"in e&&n(1,a=e.disabled),"$$scope"in e&&n(2,o=e.$$scope)},[i,a,o,r]}Store=__decorateClass$9([injectable(),__decorateParam$6(0,inject(TYPES.StorageManager))],Store);class Button extends SvelteComponent{constructor(e){super(),init(this,e,instance$4,create_fragment$4,safe_not_equal,{onClick:0,disabled:1})}}const settingPreview_svelte_svelte_type_style_lang="";function create_if_block_4$1(e){let t,n,r,o,i,a,s=_("url")+"",c=e[0].url+"";return{c(){t=element("div"),n=text(s),r=text(": "),o=element("a"),i=text(c),attr(o,"href",a=e[0].url),attr(o,"target","_blank"),attr(o,"rel","noreferrer"),attr(t,"class","plugin-item")},m(e,a){insert(e,t,a),append(t,n),append(t,r),append(t,o),append(o,i)},p(e,t){1&t&&c!==(c=e[0].url+"")&&set_data(i,c),1&t&&a!==(a=e[0].url)&&attr(o,"href",a)},d(e){e&&detach(t)}}}function create_if_block_3$1(e){let t,n,r,o,i=_("author")+"",a=e[0].author+"";return{c(){t=element("div"),n=text(i),r=text(": "),o=text(a),attr(t,"class","plugin-item")},m(e,i){insert(e,t,i),append(t,n),append(t,r),append(t,o)},p(e,t){1&t&&a!==(a=e[0].author+"")&&set_data(o,a)},d(e){e&&detach(t)}}}function create_if_block_2$1(e){let t,n,r,o,i=_("version")+"",a=e[0].version+"";return{c(){t=element("div"),n=text(i),r=text(": "),o=text(a),attr(t,"class","plugin-item")},m(e,i){insert(e,t,i),append(t,n),append(t,r),append(t,o)},p(e,t){1&t&&a!==(a=e[0].version+"")&&set_data(o,a)},d(e){e&&detach(t)}}}function create_if_block_1$2(e){let t,n,r,o,i=_("description")+"",a=e[0].description+"";return{c(){t=element("div"),n=text(i),r=text(": "),o=text(a),attr(t,"class","plugin-item")},m(e,i){insert(e,t,i),append(t,n),append(t,r),append(t,o)},p(e,t){1&t&&a!==(a=e[0].description+"")&&set_data(o,a)},d(e){e&&detach(t)}}}function create_else_block$2(e){let t,n,r=e[2]()+"";return{c(){t=new HtmlTag(!1),n=empty(),t.a=n},m(e,o){t.m(r,e,o),insert(e,n,o)},p(e,n){4&n&&r!==(r=e[2]()+"")&&t.p(r)},d(e){e&&detach(n),e&&t.d()}}}function create_if_block$2(e){let t;return{c(){t=element("span"),t.textContent=`${_("readme")}`},m(e,n){insert(e,t,n)},p:noop,d(e){e&&detach(t)}}}function create_fragment$3(e){let t,n,r,o,i,a,s,c,u,l,d,p,f,g,h,y,m,v,b,w,S,E,A,T,P,k,O=e[0].name+"",$=e[0].key+"",x=_("goBack")+"",C=e[0].url&&create_if_block_4$1(e),N=e[0].author&&create_if_block_3$1(e),I=e[0].version&&create_if_block_2$1(e),D=e[0].description&&create_if_block_1$2(e);function R(e,t){return e[1]?create_if_block$2:create_else_block$2}let B=R(e),L=B(e);return{c(){t=element("div"),n=element("div"),r=element("div"),o=element("div"),i=text(O),a=space(),s=element("div"),c=text("("),u=text($),l=text(")"),d=space(),p=element("button"),f=svg_element("svg"),g=svg_element("use"),h=text(x),y=space(),m=element("div"),C&&C.c(),v=space(),N&&N.c(),b=space(),I&&I.c(),w=space(),D&&D.c(),S=space(),E=element("hr"),A=space(),T=element("div"),L.c(),attr(o,"class","plugin-name svelte-bj9chc"),attr(s,"class","plugin-key svelte-bj9chc"),xlink_attr(g,"xlink:href","#iconBack"),attr(f,"class","go-back-icon svelte-bj9chc"),attr(p,"class","go-back b3-button svelte-bj9chc"),attr(r,"class","plugin-info svelte-bj9chc"),attr(m,"class","plugin-manifest svelte-bj9chc"),attr(n,"class","plugin-basic"),attr(T,"class","plugin-readme b3-typography svelte-bj9chc"),attr(t,"class","plugin-detail svelte-bj9chc")},m(_,O){insert(_,t,O),append(t,n),append(n,r),append(r,o),append(o,i),append(r,a),append(r,s),append(s,c),append(s,u),append(s,l),append(r,d),append(r,p),append(p,f),append(f,g),append(p,h),append(n,y),append(n,m),C&&C.m(m,null),append(m,v),N&&N.m(m,null),append(m,b),I&&I.m(m,null),append(m,w),D&&D.m(m,null),append(t,S),append(t,E),append(t,A),append(t,T),L.m(T,null),P||(k=listen(p,"click",e[5]),P=!0)},p(e,[t]){1&t&&O!==(O=e[0].name+"")&&set_data(i,O),1&t&&$!==($=e[0].key+"")&&set_data(u,$),e[0].url?C?C.p(e,t):(C=create_if_block_4$1(e),C.c(),C.m(m,v)):C&&(C.d(1),C=null),e[0].author?N?N.p(e,t):(N=create_if_block_3$1(e),N.c(),N.m(m,b)):N&&(N.d(1),N=null),e[0].version?I?I.p(e,t):(I=create_if_block_2$1(e),I.c(),I.m(m,w)):I&&(I.d(1),I=null),e[0].description?D?D.p(e,t):(D=create_if_block_1$2(e),D.c(),D.m(m,null)):D&&(D.d(1),D=null),B===(B=R(e))&&L?L.p(e,t):(L.d(1),L=B(e),L&&(L.c(),L.m(T,null)))},i:noop,o:noop,d(e){e&&detach(t),C&&C.d(),N&&N.d(),I&&I.d(),D&&D.d(),L.d(),P=!1,k()}}}function instance$3(e,t,n){let r;const o=createEventDispatcher();let i=!0,{plugin:a}=t;let s;const c=window.Lute.New();onMount((()=>{(async()=>{n(4,s=await container.get("Store").getPluginReadme(a.key)),n(1,i=!1)})()}));const u=()=>{o("goback")};return e.$$set=e=>{"plugin"in e&&n(0,a=e.plugin)},e.$$.update=()=>{16&e.$$.dirty&&n(2,r=()=>s?c.Md2HTML(s):"")},[a,i,r,u,s,()=>u()]}class Setting_preview extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{plugin:0})}}function get_each_context$1(e,t,n){const r=e.slice();return r[11]=t[n],r}function create_else_block_2(e){let t,n;return t=new Setting_preview({props:{plugin:e[3]}}),t.$on("goback",e[9]),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.plugin=e[3]),t.$set(r)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_1$1(e){let t,n,r=e[0],o=[];for(let a=0;a<r.length;a+=1)o[a]=create_each_block$1(get_each_context$1(e,r,a));const i=e=>transition_out(o[e],1,1,(()=>{o[e]=null}));return{c(){t=element("div");for(let e=0;e<o.length;e+=1)o[e].c();attr(t,"class","fn__flex-1")},m(e,r){insert(e,t,r);for(let n=0;n<o.length;n+=1)o[n].m(t,null);n=!0},p(e,n){if(53&n){let a;for(r=e[0],a=0;a<r.length;a+=1){const i=get_each_context$1(e,r,a);o[a]?(o[a].p(i,n),transition_in(o[a],1)):(o[a]=create_each_block$1(i),o[a].c(),transition_in(o[a],1),o[a].m(t,null))}for(group_outros(),a=r.length;a<o.length;a+=1)i(a);check_outros()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)transition_in(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)transition_out(o[t]);n=!1},d(e){e&&detach(t),destroy_each(o,e)}}}function create_if_block$1(e){let t;return{c(){t=element("div"),t.textContent=`${_("loading")}`},m(e,n){insert(e,t,n)},p:noop,i:noop,o:noop,d(e){e&&detach(t)}}}function create_else_block_1(e){let t,n;function r(){return e[8](e[11])}return t=new Button({props:{onClick:r,$$slots:{default:[create_default_slot_3]},$$scope:{ctx:e}}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(n,o){e=n;const i={};1&o&&(i.onClick=r),16384&o&&(i.$$scope={dirty:o,ctx:e}),t.$set(i)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_3(e){let t,n,r,o;const i=[create_if_block_4,create_else_block$1],a=[];function s(e,t){return e[11].needUpgrade?0:1}return t=s(e),n=a[t]=i[t](e),{c(){n.c(),r=empty()},m(e,n){a[t].m(e,n),insert(e,r,n),o=!0},p(e,o){let c=t;t=s(e),t===c?a[t].p(e,o):(group_outros(),transition_out(a[c],1,1,(()=>{a[c]=null})),check_outros(),n=a[t],n?n.p(e,o):(n=a[t]=i[t](e),n.c()),transition_in(n,1),n.m(r.parentNode,r))},i(e){o||(transition_in(n),o=!0)},o(e){transition_out(n),o=!1},d(e){a[t].d(e),e&&detach(r)}}}function create_if_block_2(e){let t,n;return t=new Button({props:{disabled:!0,$$slots:{default:[create_default_slot]},$$scope:{ctx:e}}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(e,n){const r={};16384&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_default_slot_3(e){let t,n=_("download")+"";return{c(){t=text(n)},m(e,n){insert(e,t,n)},p:noop,d(e){e&&detach(t)}}}function create_else_block$1(e){let t,n;return t=new Button({props:{disabled:!0,$$slots:{default:[create_default_slot_2]},$$scope:{ctx:e}}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(e,n){const r={};16384&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block_4(e){let t,n;function r(){return e[7](e[11])}return t=new Button({props:{onClick:r,$$slots:{default:[create_default_slot_1]},$$scope:{ctx:e}}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(n,o){e=n;const i={};1&o&&(i.onClick=r),16384&o&&(i.$$scope={dirty:o,ctx:e}),t.$set(i)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_default_slot_2(e){let t,n=_("downloaded")+"";return{c(){t=text(n)},m(e,n){insert(e,t,n)},p:noop,d(e){e&&detach(t)}}}function create_default_slot_1(e){let t,n=_("upgrade")+"";return{c(){t=text(n)},m(e,n){insert(e,t,n)},p:noop,d(e){e&&detach(t)}}}function create_default_slot(e){let t,n=_("downloading")+"";return{c(){t=text(n)},m(e,n){insert(e,t,n)},p:noop,d(e){e&&detach(t)}}}function create_each_block$1(e){let t,n,r,o,i,a,s,c,u,l,d,p,f,g,h,_,y,m,v=e[11].name+"",b=e[11].version+"",w=(e[11].description||"")+"";function S(...t){return e[6](e[11],...t)}const E=[create_if_block_2,create_if_block_3,create_else_block_1],A=[];function T(e,t){return e[2][e[11].key]?0:e[11].isExist?1:2}return f=T(e),g=A[f]=E[f](e),{c(){t=element("label"),n=element("div"),r=element("a"),o=text(v),i=space(),a=text(b),s=space(),c=element("div"),u=text(w),l=space(),d=element("span"),p=space(),g.c(),h=space(),attr(r,"href","javascript:void(0)"),attr(r,"class",""),attr(c,"class","b3-label__text"),attr(n,"class","fn__flex-1"),attr(d,"class","fn__space"),attr(t,"class","fn__flex b3-label")},m(e,g){insert(e,t,g),append(t,n),append(n,r),append(r,o),append(n,i),append(n,a),append(n,s),append(n,c),append(c,u),append(t,l),append(t,d),append(t,p),A[f].m(t,null),append(t,h),_=!0,y||(m=listen(r,"click",S),y=!0)},p(n,r){e=n,(!_||1&r)&&v!==(v=e[11].name+"")&&set_data(o,v),(!_||1&r)&&b!==(b=e[11].version+"")&&set_data(a,b),(!_||1&r)&&w!==(w=(e[11].description||"")+"")&&set_data(u,w);let i=f;f=T(e),f===i?A[f].p(e,r):(group_outros(),transition_out(A[i],1,1,(()=>{A[i]=null})),check_outros(),g=A[f],g?g.p(e,r):(g=A[f]=E[f](e),g.c()),transition_in(g,1),g.m(t,h))},i(e){_||(transition_in(g),_=!0)},o(e){transition_out(g),_=!1},d(e){e&&detach(t),A[f].d(),y=!1,m()}}}function create_fragment$2(e){let t,n,r,o;const i=[create_if_block$1,create_if_block_1$1,create_else_block_2],a=[];function s(e,t){return e[1]?0:e[3]?2:1}return n=s(e),r=a[n]=i[n](e),{c(){t=element("div"),r.c(),attr(t,"class","b3-label fn__flex")},m(e,r){insert(e,t,r),a[n].m(t,null),o=!0},p(e,[o]){let c=n;n=s(e),n===c?a[n].p(e,o):(group_outros(),transition_out(a[c],1,1,(()=>{a[c]=null})),check_outros(),r=a[n],r?r.p(e,o):(r=a[n]=i[n](e),r.c()),transition_in(r,1),r.m(t,null))},i(e){o||(transition_in(r),o=!0)},o(e){transition_out(r),o=!1},d(e){e&&detach(t),a[n].d()}}}function instance$2(e,t,n){const r=container.get(TYPES.Store);let o=[],i=!0;const a={};onMount((async()=>{n(0,o=await r.loadPlugins()),n(1,i=!1)}));const s=async e=>{if(!a[e])try{n(2,a[e]=!0,a),await r.downloadPlugin(e);const t=o.find((t=>t.key===e));t&&(t.isExist=!0,t.needUpgrade=!1)}finally{n(2,a[e]=!1,a)}};let c=null;const u=(e,t)=>{n(3,c=t),e.stopPropagation(),e.preventDefault()};return[o,i,a,c,s,u,(e,t)=>u(t,e),e=>s(e.key),e=>s(e.key),()=>n(3,c=null)]}class Setting_store extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{})}}function create_fragment$1(e){let t;return{c(){t=element("div"),attr(t,"id","setting-custom-render")},m(e,n){insert(e,t,n)},p:noop,i:noop,o:noop,d(e){e&&detach(t)}}}function instance$1(e,t,n){let r,{render:o}=t;return onMount((()=>{n(1,r=document.createElement("div")),document.getElementById("setting-custom-render").appendChild(r),o(r)})),e.$$set=e=>{"render"in e&&n(0,o=e.render)},e.$$.update=()=>{if(3&e.$$.dirty){document.getElementById("setting-custom-render")&&(r&&r.remove(),n(1,r=document.createElement("div")),document.getElementById("setting-custom-render").appendChild(r),o(r))}},[o,r]}class Setting_custom extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{render:0})}}function get_each_context(e,t,n){const r=e.slice();return r[13]=t[n],r}function get_each_context_1(e,t,n){const r=e.slice();return r[13]=t[n],r}function create_each_block_1(e){let t,n,r,o,i,a,s=e[13].name+"";function c(){return e[6](e[13])}return{c(){t=element("li"),n=element("span"),r=text(s),attr(n,"class","b3-list-item__text"),attr(t,"data-name",e[13].key),attr(t,"class",o=e[0].key===e[13].key?"b3-list-item--focus b3-list-item b3-list-item--big":"b3-list-item b3-list-item--big")},m(e,o){insert(e,t,o),append(t,n),append(n,r),i||(a=listen(t,"click",c),i=!0)},p(n,r){e=n,1&r&&o!==(o=e[0].key===e[13].key?"b3-list-item--focus b3-list-item b3-list-item--big":"b3-list-item b3-list-item--big")&&attr(t,"class",o)},d(e){e&&detach(t),i=!1,a()}}}function create_if_block_1(e){let t;return{c(){t=element("hr"),set_style(t,"margin","12px")},m(e,n){insert(e,t,n)},d(e){e&&detach(t)}}}function create_each_block(e){let t,n,r,o,i,a,s,c,u=e[13].name+"";function l(){return e[7](e[13])}return{c(){t=element("li"),n=element("span"),r=text(u),o=space(),attr(n,"class","b3-list-item__text"),attr(t,"data-name",i=e[13].key),attr(t,"class",a=e[0].key===e[13].key?"b3-list-item--focus b3-list-item b3-list-item--big":"b3-list-item b3-list-item--big")},m(e,i){insert(e,t,i),append(t,n),append(n,r),append(t,o),s||(c=listen(t,"click",l),s=!0)},p(n,o){e=n,2&o&&u!==(u=e[13].name+"")&&set_data(r,u),2&o&&i!==(i=e[13].key)&&attr(t,"data-name",i),3&o&&a!==(a=e[0].key===e[13].key?"b3-list-item--focus b3-list-item b3-list-item--big":"b3-list-item b3-list-item--big")&&attr(t,"class",a)},d(e){e&&detach(t),s=!1,c()}}}function create_else_block(e){let t,n;return t=new Setting_custom({props:{render:e[0].render}}),{c(){create_component(t.$$.fragment)},m(e,r){mount_component(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.render=e[0].render),t.$set(r)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}function create_if_block(e){let t,n,r;var o=e[0].component;return o&&(t=construct_svelte_component(o,{}),t.$on("update",e[8])),{c(){t&&create_component(t.$$.fragment),n=empty()},m(e,o){t&&mount_component(t,e,o),insert(e,n,o),r=!0},p(e,r){if(o!==(o=e[0].component)){if(t){group_outros();const e=t;transition_out(e.$$.fragment,1,0,(()=>{destroy_component(e,1)})),check_outros()}o?(t=construct_svelte_component(o,{}),t.$on("update",e[8]),create_component(t.$$.fragment),transition_in(t.$$.fragment,1),mount_component(t,n.parentNode,n)):t=null}},i(e){r||(t&&transition_in(t.$$.fragment,e),r=!0)},o(e){t&&transition_out(t.$$.fragment,e),r=!1},d(e){e&&detach(n),t&&destroy_component(t,e)}}}function create_fragment(e){let t,n,r,o,i,a,s,c,u,l,d,p=e[2],f=[];for(let b=0;b<p.length;b+=1)f[b]=create_each_block_1(get_each_context_1(e,p,b));let g=e[1].length>0&&create_if_block_1(),h=e[1],_=[];for(let b=0;b<h.length;b+=1)_[b]=create_each_block(get_each_context(e,h,b));const y=[create_if_block,create_else_block],m=[];function v(e,t){return"internal"===e[0].type?0:1}return c=v(e),u=m[c]=y[c](e),{c(){t=element("div"),n=element("div"),r=element("ul");for(let e=0;e<f.length;e+=1)f[e].c();o=space(),g&&g.c(),i=space();for(let e=0;e<_.length;e+=1)_[e].c();a=space(),s=element("div"),u.c(),attr(r,"class","b3-tab-bar b3-list b3-list--background"),set_style(r,"height","unset",1),attr(s,"class","config__tab-container"),set_style(s,"height","unset",1),attr(s,"data-name",l=e[0].key),attr(n,"class","fn__flex-1 fn__flex config__panel"),attr(t,"class","fn__flex-column"),set_style(t,"border-radius","4px"),set_style(t,"overflow","auto"),set_style(t,"position","relative"),set_style(t,"height","80vh")},m(e,u){insert(e,t,u),append(t,n),append(n,r);for(let t=0;t<f.length;t+=1)f[t].m(r,null);append(r,o),g&&g.m(r,null),append(r,i);for(let t=0;t<_.length;t+=1)_[t].m(r,null);append(n,a),append(n,s),m[c].m(s,null),d=!0},p(e,[t]){if(13&t){let n;for(p=e[2],n=0;n<p.length;n+=1){const i=get_each_context_1(e,p,n);f[n]?f[n].p(i,t):(f[n]=create_each_block_1(i),f[n].c(),f[n].m(r,o))}for(;n<f.length;n+=1)f[n].d(1);f.length=p.length}if(e[1].length>0?g||(g=create_if_block_1(),g.c(),g.m(r,i)):g&&(g.d(1),g=null),11&t){let n;for(h=e[1],n=0;n<h.length;n+=1){const o=get_each_context(e,h,n);_[n]?_[n].p(o,t):(_[n]=create_each_block(o),_[n].c(),_[n].m(r,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=h.length}let n=c;c=v(e),c===n?m[c].p(e,t):(group_outros(),transition_out(m[n],1,1,(()=>{m[n]=null})),check_outros(),u=m[c],u?u.p(e,t):(u=m[c]=y[c](e),u.c()),transition_in(u,1),u.m(s,null)),(!d||1&t&&l!==(l=e[0].key))&&attr(s,"data-name",l)},i(e){d||(transition_in(u),d=!0)},o(e){transition_out(u),d=!1},d(e){e&&detach(t),destroy_each(f,e),g&&g.d(),destroy_each(_,e),m[c].d()}}}function instance(e,t,n){let r;const o=[{key:"common",name:_("menu_common"),type:"internal",component:Setting_common},{key:"list",name:_("menu_list"),type:"internal",component:Setting_list},{key:"store",name:_("menu_store"),type:"internal",component:Setting_store}],i=container.get(TYPES.SettingManager),a=container.get(TYPES.StorageManager).getThirdPartyPlugins();let s=i.getSettingRenders();const c=e=>n(0,l=e),u=()=>{n(5,s=[...i.getSettingRenders()])};let l=o[0];return e.$$.update=()=>{32&e.$$.dirty&&n(1,r=s.map((e=>{return{key:e.key,name:(t=e.key,null==(n=a.find((e=>e.key===t)))?void 0:n.name),component:Setting_common,type:"custom",render:e.value};var t,n})))},[l,r,o,c,u,s,e=>c(e),e=>c(e),()=>u()]}class Setting extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}class InternalSettingPlugin extends Plugin{constructor(){super(),this.svg='<svg t="1679703027227" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="24715" width="200" height="200"><path d="M512 1023.99984a75.519988 75.519988 0 0 1-53.679992-22.207997L22.368077 565.455912c-29.487995-29.679995-29.487995-77.919988-0.064-107.519984l159.711975-159.839975a31.951995 31.951995 0 0 1 54.047991 28.207996 131.10398 131.10398 0 0 0-2.368 23.135996c0 69.951989 56.895991 128.11198 126.847981 128.11198 69.999989 0 121.119981-58.159991 121.119981-128.11198 0-70.079989-51.119992-127.07198-121.119981-127.07198a130.87998 130.87998 0 0 0-23.007997 2.384 31.759995 31.759995 0 0 1-33.919994-16.671998 31.999995 31.999995 0 0 1 5.743999-37.423994l148.895976-149.103976c28.847995-28.719996 78.719988-28.655996 107.423984-0.064l109.023983 109.183983C697.439971 59.887991 763.871961 8.479999 842.015948 8.479999c96.911985 0 175.743973 78.959988 175.743973 175.967972 0 78.239988-51.295992 144.719977-122.063981 167.471974l105.887984 105.951983a76.351988 76.351988 0 0 1 0.031999 107.551984L565.743992 1001.775843A75.759988 75.759988 0 0 1 512 1023.99984z" fill="" p-id="24716"></path></svg>'}onload(){const e=document.createElement("button");e.setAttribute("aria-label",_("plugin_system")),e.classList.add("toolbar__item","b3-tooltips","b3-tooltips__sw"),e.insertAdjacentHTML("beforeend",this.svg),e.addEventListener("click",(e=>{new Menu("internalSettingButton").addItem(new MenuItem({label:_("plugin_system_setting"),icon:"iconEdit",click:()=>showSettingDialog()})).addSeparator().addItem(new MenuItem({label:_("reload"),icon:"iconRefresh",click:()=>window.location.reload()})).showAtMouseEvent(e),e.stopPropagation()})),addToolbarRight(e),this.registerCommand({command:"Show plugin system conifg",description:_("show_plugin_system_config"),shortcut:"command+option+p",callback:()=>showSettingDialog()}),this.registerCommand({command:"Reload Window",description:_("reload_window"),callback:()=>window.location.reload()})}}function showSettingDialog(){new Dialog({title:_("plugin_system_setting"),content:'<div id="plugin-settings"></div>',width:"90vw",height:"80vh"}),setTimeout((()=>{new Setting({target:document.getElementById("plugin-settings")})}))}const internalPlugins=[{key:"setting",name:"setting",plugin:InternalSettingPlugin,enabled:!0,hidden:!0,version:"1.0.0"},{key:"commandPanel",name:"commandPanel",plugin:CommandPanelPlugin,enabled:!0,hidden:!0,version:"1.0.0"}];function isHighSurrogate$1(e){return e>=55296&&e<=56319}function isLowSurrogate$1(e){return e>=56320&&e<=57343}var truncate$2=function(e,t,n){if("string"!=typeof t)throw new Error("Input must be string");for(var r,o,i=t.length,a=0,s=0;s<i;s+=1){if(r=t.charCodeAt(s),o=t[s],isHighSurrogate$1(r)&&isLowSurrogate$1(t.charCodeAt(s+1))&&(o+=t[s+=1]),(a+=e(o))===n)return t.slice(0,s+1);if(a>n)return t.slice(0,s-o.length+1)}return t};function isHighSurrogate(e){return e>=55296&&e<=56319}function isLowSurrogate(e){return e>=56320&&e<=57343}var browser$1=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var t=e.length,n=0,r=null,o=null,i=0;i<t;i++)isLowSurrogate(r=e.charCodeAt(i))?null!=o&&isHighSurrogate(o)?n+=1:n+=3:r<=127?n+=1:r>=128&&r<=2047?n+=2:r>=2048&&r<=65535&&(n+=3),o=r;return n},truncate$1=truncate$2,getLength=browser$1,browser=truncate$1.bind(null,getLength),truncate=browser,illegalRe=/[\/\?<>\\:\*\|"]/g,controlRe=/[\x00-\x1f\x80-\x9f]/g,reservedRe=/^\.+$/,windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,windowsTrailingRe=/[\. ]+$/;function sanitize(e,t){if("string"!=typeof e)throw new Error("Input must be string");var n=e.replace(illegalRe,t).replace(controlRe,t).replace(reservedRe,t).replace(windowsReservedRe,t).replace(windowsTrailingRe,t);return truncate(n,255)}var sanitizeFilename=function(e,t){var n=t&&t.replacement||"",r=sanitize(e,n);return""===n?r:sanitize(r,"")},__defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$8(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$8(t,n,i),i},__decorateParam$5=(e,t)=>(n,r)=>t(n,r,e);let StorageManager=class{constructor(e){this.config=Object.assign({},defaultConfig),this.pluginFileManager=e}get(e){return this.config[e]}async set(e,t){return this.config[e]=t,setStorageVal(e,t)}async initStorage(){const e=await getLocalStorage(),t=Object.keys(defaultConfig);for(const n of t)void 0!==e[n]?this.config[n]=e[n]:await setStorageVal(n,defaultConfig[n]);return this.thirdPartyPlugins=await this.pluginFileManager.getAllPlugins(),this.internalPlugins=[...internalPlugins],this.init3rdPartyEnabled(),this.initInternalEnabled(),await this.savePluginsEnabled(),this}init3rdPartyEnabled(){const e=this.get(PLUGIN_SYSTEM_THIRD_PARTY_PLUGIN);for(const t of e)for(const e of this.thirdPartyPlugins)if(e.key===t.key){e.enabled=t.enabled||!1;break}}initInternalEnabled(){const e=this.get(PLUGIN_SYSTEM_PLUGIN);for(const t of e)for(const e of this.internalPlugins)if(e.key===t.key){e.enabled=t.enabled||!1;break}}getPlugins(){return[...this.internalPlugins,...this.thirdPartyPlugins]}getInternalPlugins(){return this.internalPlugins}getThirdPartyPlugins(){return this.thirdPartyPlugins}getPluginByKey(e){return this.getPlugins().find((t=>t.key===e))}async setPluginEnabled(e,t){for(const n of[...this.internalPlugins,...this.thirdPartyPlugins])if(n.key===e){n.enabled=t;break}await this.savePluginsEnabled()}async setSafeModeEnabled(e){return this.set(PLUGIN_SYSTEM_SAFE_MODE_ENABLED,e)}async savePluginsEnabled(){return await this.set(PLUGIN_SYSTEM_PLUGIN,this.internalPlugins.map((e=>({key:e.key,enabled:e.enabled})))),this.set(PLUGIN_SYSTEM_THIRD_PARTY_PLUGIN,this.thirdPartyPlugins.map((e=>({key:e.key,enabled:e.enabled}))))}async setPluginStorage(t,n,r){try{if(this.isFileNameIllegal(n))return void showErrorMessage(`插件${t}存储文件名不合法`);await this.addPluginStorageFolderIfNotExist(t),await FileClient.getInstanceApi().fileApi.putFile(`/data/plugins/.storage/${t}/${n}`,r)}catch(e){showErrorMessage(`插件${t}存储保存失败`,2e3)}}async getPluginStorage(t,n){try{return await FileClient.getInstanceApi().fileApi.getFile(`/data/plugins/.storage/${t}/${n}`)}catch(e){return showErrorMessage(`插件${t}存储保存失败`,2e3),null}}async uninstallPlugin(e){await FileClient.getInstanceApi().fileApi.removeFile(`/data/plugins/${e}`),await FileClient.getInstanceApi().fileApi.removeFile(`/data/plugins//.storage/${e}`)}async addPluginStorageFolderIfNotExist(e){const t=`/data/plugins/.storage/${e}`;await FileClient.getInstanceApi().fileApi.putFile(t,null,!0)}isFileNameIllegal(e){return e!==sanitizeFilename(e)}};StorageManager=__decorateClass$8([injectable(),__decorateParam$5(0,inject(TYPES.PluginFileManager))],StorageManager);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$7(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$7(t,n,i),i},__decorateParam$4=(e,t)=>(n,r)=>t(n,r,e);let PluginSystem=class{constructor(e,t,n,r,o){this.pluginLoader=e,this.pslm=t,this.storageManager=n,this.commandManager=r,this.store=o,this.version=VERSION$1}async init(){await this.storageManager.initStorage();const e=this.storageManager.getInternalPlugins();this.pluginLoader.loadEnabledPlugins(e),log(`Loading internal enabled plugins: ${e.map((e=>e.key)).join(",")}`);if(!this.storageManager.get(PLUGIN_SYSTEM_SAFE_MODE_ENABLED)){const e=this.storageManager.getThirdPartyPlugins();log(`Loading 3rd party enabled plugins: ${e.map((e=>e.key)).join(",")}`),this.pluginLoader.loadEnabledPlugins(e)}return this.pslm.localCacheInit(),this}async loadPlugin(e){this.storageManager.setPluginEnabled(e,!0);const t=this.storageManager.getPluginByKey(e);this.pluginLoader.loadPlugin(t)}async unloadPlugin(e){this.storageManager.setPluginEnabled(e,!1),this.pluginLoader.unloadPlugin(e)}async turnOffSafeMode(){this.storageManager.setSafeModeEnabled(!1);const e=this.storageManager.getThirdPartyPlugins();return this.pluginLoader.loadEnabledPlugins(e)}async turnOnSafeMode(){this.storageManager.setSafeModeEnabled(!0);const e=this.storageManager.getThirdPartyPlugins();return this.pluginLoader.unloadThirdPartyPlugins(e)}};PluginSystem=__decorateClass$7([injectable(),__decorateParam$4(0,inject(TYPES.PluginLoader)),__decorateParam$4(1,inject(TYPES.SystemManager)),__decorateParam$4(2,inject(TYPES.StorageManager)),__decorateParam$4(3,inject(TYPES.CommandManager)),__decorateParam$4(4,inject(TYPES.Store))],PluginSystem);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$6(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$6(t,n,i),i},__decorateParam$3=(e,t)=>(n,r)=>t(n,r,e);let SystemManager=class{constructor(e){this.storageMangager=e}async saveToLocal(e,t){FileClient.getInstanceApi().fileApi.putFile(e,t)}async localCacheInit(){}delayAutoUpgrade(){setTimeout((()=>{this.storageMangager.get(PLUGIN_SYSTEM_AUTO_UPDATE)?this.tryUpgrade():log("Auto Update skipped")}),1e3)}async tryUpgrade(){}async getOnlineVersion(){return VERSION$1}async upgrade(){}};SystemManager=__decorateClass$6([injectable(),__decorateParam$3(0,inject(TYPES.StorageManager))],SystemManager);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$5(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$5(t,n,i),i},__decorateParam$2=(e,t)=>(n,r)=>t(n,r,e);let components,PluginLoader=class{constructor(e){this.pluginFileManager=e,this.loadedPlugins=new Map}async loadEnabledPlugins(e){if(e&&e.length)for(const t of e)t.enabled&&await this.loadPlugin(t)}async loadAllInternalPlugins(){internalPlugins.forEach((async e=>{const t=new e.plugin;if(!(t instanceof Plugin))throw new Error(`Failed to load plugin ${e.name}`);log(`Load internal plugin: ${e.key}(${e.name})`),this.addAdditionalMethod(t,e.key,e.name),await t.onload(),this.loadedPlugins.set(e.key,t)}))}async loadAllLocalPlugins(){const e=await this.pluginFileManager.getAllPlugins();if(e)for(const t of e)await this.loadPlugin(t)}async loadPlugin(plugin){if(components||this.generateRequiredModules(),!plugin.enabled||!plugin.plugin&&!plugin.script)return;if(plugin.plugin){const e=new plugin.plugin;if(!(e instanceof Plugin))throw new Error(`Failed to load plugin ${plugin.name}`);return log(`Load internal plugin: ${plugin.key}(${plugin.name})`),this.addAdditionalMethod(e,plugin.key,plugin.name),await e.onload(),void this.loadedPlugins.set(plugin.key,e)}const exports={},module={exports:exports};function run(script,name){return eval("(function anonymous(require,module,exports){".concat(script,"\n})\n//# sourceURL=").concat(name,"\n"))}const __require=e=>{if(components[e])return components[e];throw new Error(`module ${e} not found`)},pluginName=plugin.key;try{run(plugin.script,plugin.key)(__require,module,exports)}catch(e){return void error("Error plugin:"+plugin.key+" ->",e)}let pluginConstructor;if(!(pluginConstructor=(module.exports||exports).default||module.exports))throw new Error(`Failed to load plugin ${pluginName}. No exports detected.`);const plug=new pluginConstructor;if(!(plug instanceof Plugin))throw new Error(`Failed to load plugin ${pluginName}`);this.addAdditionalMethod(plug,plugin.key,pluginName);try{await plug.onload(),this.loadedPlugins.set(plugin.key,plug)}catch(e){error("Error plugin:"+plugin.key+" ->",e)}}async unloadPlugin(e){const t=this.loadedPlugins.get(e);t&&(t.onunload(),container.get(TYPES.CommandManager).unregisterCommandByPlugin(e),container.get(TYPES.SettingManager).unregisterSetting(e),this.loadedPlugins.delete(e))}async unloadThirdPartyPlugins(e){const t=e.filter((e=>e.enabled)).map((e=>e.key));for(const n of t)log(`unload third party plugin: ${n}`),await this.unloadPlugin(n)}async loadThirdPartyEnabledPlugins(e){return this.loadEnabledPlugins(e)}generateRequiredModules(){components={siyuan:api,axios:axios$1}}addAdditionalMethod(e,t,n){e.registerCommand=e=>{container.get(TYPES.CommandManager).registerCommand({...e,plugin:t,pluginName:n})};const r=container.get(TYPES.StorageManager);e.writeStorage=async(e,n)=>await r.setPluginStorage(t,e,n),e.loadStorage=async e=>await r.getPluginStorage(t,e),e.registerSettingRender=e=>{container.get(TYPES.SettingManager).registerSetting(t,e)}}};PluginLoader=__decorateClass$5([injectable(),__decorateParam$2(0,inject(TYPES.PluginFileManager))],PluginLoader);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$4(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$4(t,n,i),i};let PluginFileManager=class{async scanPlugins(e){const t=await FileClient.getInstanceApi().fileApi.readDir(e);if(!t)return[];const n=t,r=[];for(const o of n)o.name.startsWith(".")||o.isDir&&await isExists(`/data/plugins/${o.name}/manifest.json`)&&await isExists(`/data/plugins/${o.name}/main.js`)&&r.push(`/data/plugins/${o.name}`);return r}async getFileContent(e){return await FileClient.getInstanceApi().fileApi.getFile(e)||""}async getManifest(t){const n=await this.getFileContent(t);try{return JSON.parse(n)}catch(e){return error("loading manifest: "+t,e),null}}async getScript(e){return await this.getFileContent(e)}async getAllPlugins(){const e=await this.scanPlugins("/data/plugins");if(!e||!e.length)return log("No plugin found in /data/plugins"),[];const t=[];for(const n of e){log("Reading plugin from filesystem: "+n);const e=this.getFolderName(n),r=async()=>{const[t,r]=await Promise.all([this.getManifest(`${n}/manifest.json`),this.getScript(`${n}/main.js`)]);return{...t,script:r,enabled:!1,key:e}};t.push(r())}return await Promise.all(t)||[]}getFolderName(e){const t=e.split("/");for(let n=t.length-1;n>=0;n--)if(t[n])return t[n];return""}};PluginFileManager=__decorateClass$4([injectable()],PluginFileManager);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$3(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$3(t,n,i),i};let EventBus=class{constructor(){this.eventListeners={}}destroy(){delete this.eventListeners}on(e,t){return this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t),()=>this.off(e,t)}off(e,t){if(t){for(let n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]===t)return void this.eventListeners[e].splice(n,1)}else delete this.eventListeners[e]}emit(e,...t){this.eventListeners[e]&&this.eventListeners[e].forEach((e=>{e(...t)}))}};EventBus=__decorateClass$3([injectable()],EventBus);var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$2(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$2(t,n,i),i},__decorateParam$1=(e,t)=>(n,r)=>t(n,r,e);let CommandManager=class{constructor(e){this.commandList=[],this.shortcut=e}registerCommand(e){return this.commandList.some((t=>{t.plugin===e.plugin&&(t.command,e.command)}))?new Error$1("Command is already registered, do not register command repeatly"):e.shortcut&&this.commandList.some((t=>{t.shortcut,e.shortcut}))?new Warning("shortcut has already registered"):(this.commandList.push(e),this.shortcut.registerKeyboardEventFromPlugin(e),void log(`Register plugin: ${e.plugin} command: ${e.command}`))}unregisterCommandByPlugin(e){for(let t=0;t<this.commandList.length;t++)if(e===this.commandList[t].plugin){const n=this.commandList[t];log(`Unregister plugin: ${e} command: ${n.command}`),this.commandList.splice(t,1),n.shortcut&&this.shortcut.unregisterKeyboardEvent(n.shortcut)}}unregisterCommand(e){for(let t=0;t<this.commandList.length;t++)if(e.command===this.commandList[t].command&&e.plugin===this.commandList[t].plugin){this.commandList.splice(t,1);break}this.shortcut.registerKeyboardEventFromPlugin(e)}getCommands(){return this.commandList}};CommandManager=__decorateClass$2([injectable(),__decorateParam$1(0,inject(TYPES.Shortcut))],CommandManager);var isff="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function addEvent(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function getMods(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function getKeys(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function compareArray(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,o=!0,i=0;i<n.length;i++)-1===r.indexOf(n[i])&&(o=!1);return o}for(var _keyMap={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":isff?173:189,"=":isff?61:187,";":isff?59:186,"'":222,"[":219,"]":221,"\\":220},_modifier={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},_mods={16:!1,18:!1,17:!1,91:!1},_handlers={},k=1;k<20;k++)_keyMap["f".concat(k)]=111+k;var _downKeys=[],winListendFocus=!1,_scope="all",elementHasBindEvent=[],code=function(e){return _keyMap[e.toLowerCase()]||_modifier[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)},getKey=function(e){return Object.keys(_keyMap).find((function(t){return _keyMap[t]===e}))},getModifier=function(e){return Object.keys(_modifier).find((function(t){return _modifier[t]===e}))};function setScope(e){_scope=e||"all"}function getScope(){return _scope||"all"}function getPressedKeyCodes(){return _downKeys.slice(0)}function getPressedKeyString(){return _downKeys.map((function(e){return getKey(e)||getModifier(e)||String.fromCharCode(e)}))}function filter(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(r=!1),r}function isPressed(e){return"string"==typeof e&&(e=code(e)),-1!==_downKeys.indexOf(e)}function deleteScope(e,t){var n,r;for(var o in e||(e=getScope()),_handlers)if(Object.prototype.hasOwnProperty.call(_handlers,o))for(n=_handlers[o],r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++;getScope()===e&&setScope(t||"all")}function clearModifier(e){var t=e.keyCode||e.which||e.charCode,n=_downKeys.indexOf(t);if(n>=0&&_downKeys.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&_downKeys.splice(0,_downKeys.length),93!==t&&224!==t||(t=91),t in _mods)for(var r in _mods[t]=!1,_modifier)_modifier[r]===t&&(hotkeys[r]=!1)}function unbind(e){if(void 0===e)Object.keys(_handlers).forEach((function(e){return delete _handlers[e]}));else if(Array.isArray(e))e.forEach((function(e){e.key&&eachUnbind(e)}));else if("object"==typeof e)e.key&&eachUnbind(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=n[0],i=n[1];"function"==typeof o&&(i=o,o=""),eachUnbind({key:e,scope:o,method:i,splitKey:"+"})}}var eachUnbind=function(e){var t=e.key,n=e.scope,r=e.method,o=e.splitKey,i=void 0===o?"+":o;getKeys(t).forEach((function(e){var t=e.split(i),o=t.length,a=t[o-1],s="*"===a?"*":code(a);if(_handlers[s]){n||(n=getScope());var c=o>1?getMods(_modifier,t):[];_handlers[s]=_handlers[s].filter((function(e){return!((!r||e.method===r)&&e.scope===n&&compareArray(e.mods,c))}))}}))};function eventHandler(e,t,n,r){var o;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var i in o=t.mods.length>0,_mods)Object.prototype.hasOwnProperty.call(_mods,i)&&(!_mods[i]&&t.mods.indexOf(+i)>-1||_mods[i]&&-1===t.mods.indexOf(+i))&&(o=!1);(0!==t.mods.length||_mods[16]||_mods[18]||_mods[17]||_mods[91])&&!o&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function dispatch(e,t){var n=_handlers["*"],r=e.keyCode||e.which||e.charCode;if(hotkeys.filter.call(this,e)){if(93!==r&&224!==r||(r=91),-1===_downKeys.indexOf(r)&&229!==r&&_downKeys.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=modifierMap[t];e[t]&&-1===_downKeys.indexOf(n)?_downKeys.push(n):!e[t]&&_downKeys.indexOf(n)>-1?_downKeys.splice(_downKeys.indexOf(n),1):"metaKey"===t&&e[t]&&3===_downKeys.length&&(e.ctrlKey||e.shiftKey||e.altKey||(_downKeys=_downKeys.slice(_downKeys.indexOf(n))))})),r in _mods){for(var o in _mods[r]=!0,_modifier)_modifier[o]===r&&(hotkeys[o]=!0);if(!n)return}for(var i in _mods)Object.prototype.hasOwnProperty.call(_mods,i)&&(_mods[i]=e[modifierMap[i]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===_downKeys.indexOf(17)&&_downKeys.push(17),-1===_downKeys.indexOf(18)&&_downKeys.push(18),_mods[17]=!0,_mods[18]=!0);var a=getScope();if(n)for(var s=0;s<n.length;s++)n[s].scope===a&&("keydown"===e.type&&n[s].keydown||"keyup"===e.type&&n[s].keyup)&&eventHandler(e,n[s],a,t);if(r in _handlers)for(var c=0;c<_handlers[r].length;c++)if(("keydown"===e.type&&_handlers[r][c].keydown||"keyup"===e.type&&_handlers[r][c].keyup)&&_handlers[r][c].key){for(var u=_handlers[r][c],l=u.splitKey,d=u.key.split(l),p=[],f=0;f<d.length;f++)p.push(code(d[f]));p.sort().join("")===_downKeys.sort().join("")&&eventHandler(e,u,a,t)}}}function isElementBind(e){return elementHasBindEvent.indexOf(e)>-1}function hotkeys(e,t,n){_downKeys=[];var r=getKeys(e),o=[],i="all",a=document,s=0,c=!1,u=!0,l="+",d=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(i=t.scope),t.element&&(a=t.element),t.keyup&&(c=t.keyup),void 0!==t.keydown&&(u=t.keydown),void 0!==t.capture&&(d=t.capture),"string"==typeof t.splitKey&&(l=t.splitKey)),"string"==typeof t&&(i=t);s<r.length;s++)o=[],(e=r[s].split(l)).length>1&&(o=getMods(_modifier,e)),(e="*"===(e=e[e.length-1])?"*":code(e))in _handlers||(_handlers[e]=[]),_handlers[e].push({keyup:c,keydown:u,scope:i,mods:o,shortcut:r[s],method:n,key:r[s],splitKey:l,element:a});void 0!==a&&!isElementBind(a)&&window&&(elementHasBindEvent.push(a),addEvent(a,"keydown",(function(e){dispatch(e,a)}),d),winListendFocus||(winListendFocus=!0,addEvent(window,"focus",(function(){_downKeys=[]}),d)),addEvent(a,"keyup",(function(e){dispatch(e,a),clearModifier(e)}),d))}function trigger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(_handlers).forEach((function(n){_handlers[n].filter((function(n){return n.scope===t&&n.shortcut===e})).forEach((function(e){e&&e.method&&e.method()}))}))}var _api={getPressedKeyString:getPressedKeyString,setScope:setScope,getScope:getScope,deleteScope:deleteScope,getPressedKeyCodes:getPressedKeyCodes,isPressed:isPressed,filter:filter,trigger:trigger,unbind:unbind,keyMap:_keyMap,modifier:_modifier,modifierMap:modifierMap};for(var a in _api)Object.prototype.hasOwnProperty.call(_api,a)&&(hotkeys[a]=_api[a]);if("undefined"!=typeof window){var _hotkeys=window.hotkeys;hotkeys.noConflict=function(e){return e&&window.hotkeys===hotkeys&&(window.hotkeys=_hotkeys),hotkeys},window.hotkeys=hotkeys}var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc$1(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp$1(t,n,i),i},__decorateParam=(e,t)=>(n,r)=>t(n,r,e);hotkeys.filter=function(){return!0};let Shortcut=class{constructor(e){this.option={capture:!0},log("Initialize shortcut subsystem"),this.eventBus=e}registerKeyboardEvent(e,t){hotkeys(e,this.option,t),this.eventBus.on(e.toString(),t)}unregisterKeyboardEvent(e){hotkeys.unbind(e),this.eventBus.off(e.toString())}registerKeyboardEventFromPlugin(e){e.shortcut&&e.callback&&this.registerKeyboardEvent(e.shortcut,e.callback)}unregisterKeyboardEventFromPlugin(e){e.shortcut&&e.callback&&this.unregisterKeyboardEvent(e.shortcut)}};Shortcut=__decorateClass$1([injectable(),__decorateParam(0,inject(TYPES.EventBus))],Shortcut);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,n,r)=>{for(var o,i=r>1?void 0:r?__getOwnPropDesc(t,n):t,a=e.length-1;a>=0;a--)(o=e[a])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&__defProp(t,n,i),i};let SettingManager=class{constructor(){this.settingRenders=new Map}registerSetting(e,t){this.settingRenders.set(e,t)}unregisterSetting(e){this.settingRenders.delete(e)}getSettingRenders(){const e=[];return this.settingRenders.forEach(((t,n)=>{e.push({key:n,value:t})})),e}};SettingManager=__decorateClass([injectable()],SettingManager);const container=new Container;container.bind(TYPES.StorageManager).to(StorageManager).inSingletonScope(),container.bind(TYPES.SystemManager).to(SystemManager).inSingletonScope(),container.bind(TYPES.PluginSystem).to(PluginSystem).inSingletonScope(),container.bind(TYPES.PluginLoader).to(PluginLoader).inSingletonScope(),container.bind(TYPES.PluginFileManager).to(PluginFileManager).inSingletonScope(),container.bind(TYPES.EventBus).to(EventBus),container.bind(TYPES.Shortcut).to(Shortcut).inSingletonScope(),container.bind(TYPES.CommandManager).to(CommandManager).inSingletonScope(),container.bind(TYPES.Store).to(Store).inSingletonScope(),container.bind(TYPES.SettingManager).to(SettingManager).inSingletonScope(),window.pluginSystem||(log("Siyuan Plugin System loading..."),window.pluginSystemVersion=VERSION$1,window.pluginSystem=container.get(TYPES.PluginSystem).init(),window.pluginSystemIocContainer=container)})();
